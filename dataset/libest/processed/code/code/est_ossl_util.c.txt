 author routin ossl verifi cb ok x store ctx ctx cert error x store ctx error ctx x current cert x store ctx current cert ctx est log info `` enter function ok d cert error d ok cert error ok current cert x print ex fp stdout x subject current cert xn flag onelin printf `` \\n est log info `` serror d d depth lookup s\\n x store ctx parent ctx ctx ``  crl path  `` cert error x store ctx error depth ctx x verifi cert error string cert error cert error x v err unabl crl ve enabl crl check tls stack applic nt load crl verifi error occur peer s cert valid ca nt confirm revok warn applic est log warn `` crl load tls peer allow `` ok x v err explicit polici x v err cert expir just check certif ok self warn user x v err depth zero self cert extens error x v err invalid ca x v err invalid non ca x v err path length exceed x v err invalid purpos x v err crl expir x v err crl valid x v err unhandl critic extens x v err cert revok est log warn `` certif verifi fail reason d cert error ok ok function use load x store use raw data buffer data expect pem encod return number cert ad store ossl init cert store raw x store store raw size stack x info sk null x info xi bio cert cnt bio new mem buf raw size null est log err `` unabl open raw ca cert buffer\\n load file stack x crl pkey set sk pem x info read bio null null null sk null est log err `` unabl read pem encod cert bio bio free bio free scan pull crl s sk x info num sk xi sk x info shift sk xi x null est log info `` ad cert store s xi x x store add cert store xi x cert cnt xi crl null est log info `` ad crl store x store add crl store xi crl x info free xi sk null sk x info pop free sk x info free cert cnt function use popul x store structur use open ssl tls stack verifi tls peer x store alloc paramet store pointer x store structur hold cert raw array contain pem encod cert store size length raw array est error ossl init cert store x store store raw size x store set flag store cnt raw cnt ossl init cert store raw store raw size cnt est log err `` cert count zero store est err cert est err function use output open ssl error buffer use open ssl api fail d like provid user regard caus failur ossl dump ssl error bio e null buf mem bptr null e bio new bio s mem e est log err `` bio new fail err print error e bio flush e bio mem ptr e bptr est log warn `` ossl error s bptr data bio free e brief est convert pb pem convert base encod pkcs respons est server pem format param cert p point buffer contain base encod pkcs data param cert len indic size cert p buffer param pem pointer receiv pem encod data est messag data contain base encod pkcs certif function use convert data pem format function alloc memori point pem argument caller respons releas memori valu length pem buffer error est convert pb pem cert p cert len pem x x stack x cert null bio b cacert decod null cacert decod len bio pbio null pkcs p null nid pem data pem len base decod incom ca cert buffer decod origin buffer b bio new bio f base b est log err `` bio new fail bio new mem buf cert p cert len est log err `` bio new fail bio push b cacert decod malloc cert len cacert decod est log err `` malloc fail cacert decod len bio read cacert decod cert len bio free pkcs format buffer certif read stack x cert pbio bio new mem buf cacert decod cacert decod len pbio est log err `` bio new fail attempt creat mem bio ossl dump ssl error free cacert decod p di pkcs bio pbio null p est log err `` pem read bio pkcs fail ossl dump ssl error free cacert decod bio free pbio free cacert decod ve decod cert refer stack cert nid obj objnid p type nid nid pkcs cert p d sign cert nid pkcs envelop cert p d envelop cert est log err `` invalid nid valu pkcs structur pkcs free p cert est log err `` fail attain x cert stack pkcs data pkcs free p output cert new bio use pem format bio new bio s mem est log err `` bio new fail pkcs free p sk x num cert xsk x valu cert pem write bio x x bio put `` \\n bio flush convert bio pem len bio mem data pem data pem len est log err `` bio mem data fail pkcs free p pem malloc pem len pem est log err `` malloc fail pkcs free p memcpi s pem pem len pem data pem len pem  pem len  make sure s null termiant bio free pkcs free p pem len
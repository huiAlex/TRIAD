 function send est specif http error respons est send http error est ctx ctx http ctx fail code mg connect conn mg connect http ctx fail code est err bad pkcs mg send http error conn est http stat_ est http stat_ txt est bodi bad pkcs est err auth fail mg send http error conn est http stat_ est http stat_ txt est bodi unauthor est err wrong method mg send http error conn est http stat_ est http stat_ txt est bodi bad meth est err ssl ctx mg send http error conn est http stat_ est http stat_ txt est bodi bad ssl est err http mg send http error conn est http stat_ est http stat_ txt est bodi est err http content mg send http error conn est http stat_ est http stat_ txt `` mg send http error conn est http stat_ est http stat_ txt est bodi unknown err function send http accept respons client retri valu ca notifi client check later csr approv est error est server send http retri est ctx ctx http ctx delay http hdr  est http hdr max  mg connect conn mg connect http ctx snprintf http hdr est http hdr max `` s s s s s d s s est http hdr_ est http hdr eol est http hdr stat_ est http hdr eol est http hdr retri delay est http hdr eol est http hdr eol conn status code est http stat_ mg write http ctx http hdr strnlen s http hdr est http hdr max est log err `` http write error propag retri est err http write est err function handl incom cacert request client est handl cacert est ctx ctx ca cert ca cert len http ctx path seg http hdr  est http hdr max  hdrlen ca cert null est err http send http header snprintf http hdr est http hdr max `` s s s s est http hdr_ est http hdr eol est http hdr stat_ est http hdr eol hdrlen strnlen s http hdr est http hdr max snprintf http hdr hdrlen est http hdr max `` s s s est http hdr ct est http ct pkcs est http hdr eol hdrlen strnlen s http hdr est http hdr max snprintf http hdr hdrlen est http hdr max `` s s s est http hdr ce est http ce base est http hdr eol hdrlen strnlen s http hdr est http hdr max snprintf http hdr hdrlen est http hdr max `` s d s s est http hdr cl ca cert len est http hdr eol est http hdr eol mg write http ctx http hdr strnlen s http hdr est http hdr max est err http write send ca cert bodi mg write http ctx ca cert ca cert len est err http write est log info `` ca cert success sent est client est err handl ca cert request applic layer regist callback applic layer provid local configur buffer send error indic ca cert avail est server handl cacert est ctx ctx http ctx path seg est error rv ca cert len ca cert set local configur cacert buffer error indic nt cacert ctx est cacert cb est log info `` server retriev ca cert applic layer ca cert ctx est cacert cb ca cert len path seg ctx ex data ca cert est log info `` server success retriev ca cert `` `` applic layer rv est handl cacert ctx ca cert ca cert len http ctx path seg est send http error ctx http ctx est err http content rv est err ctx ca cert est log info `` server ca cert set local respond `` `` local set ca cert respons rv est handl cacert ctx ctx ca cert ctx ca cert len http ctx path seg est send http error ctx http ctx est err http content rv est err rv brief est server generat auth digest use applic calcul http digest valu base header valu provid est client param ah authent header valu client provid lib est param ha precalcul ha valu user ha defin rfc s md calcul user s id http realm user s password helper function applic use calcul http digest valu perform http digest authent est client lib est doe maintain user databas left applic intent integr extern user databas e g radius aaa ha valu calcul applic defin rfc ha md hash user id http realm user password md valu convert hex string ha expect byte contain digest null error occur est server generat auth digest est http auth hdr ah ha evp md ctx mdctx evp md md evp md uint t ha  evp max md size  ha len ha str   digest  evp max md size  d len rv ah est log err `` null auth header null ha est log err `` null ha null calcul ha use method uri mdctx evp md ctx creat evp digest init ex mdctx md null evp digest updat mdctx `` post evp digest updat mdctx `` evp digest updat mdctx ah uri strnlen s ah uri max realm evp digest final mdctx ha ha len evp md ctx destroy mdctx est hex str ha str ha ha len calcul auth digest use ha nonc nonc count client nonc qop ha mdctx evp md ctx creat evp digest init ex mdctx md null evp digest updat mdctx ha evp digest updat mdctx `` evp digest updat mdctx ah nonc strnlen s ah nonc max nonc evp digest updat mdctx `` evp digest updat mdctx ah nc strnlen s ah nc max nc evp digest updat mdctx `` evp digest updat mdctx ah cnonc strnlen s ah cnonc max nonc evp digest updat mdctx `` evp digest updat mdctx `` auth evp digest updat mdctx `` evp digest updat mdctx ha str ha len evp digest final mdctx digest d len evp md ctx destroy mdctx rv malloc est hex str rv digest d len rv function alloc http authent header structur use pass auth credenti applic layer allow app authent est client est http auth hdr est creat ah est http auth hdr ah ah malloc est http auth hdr memzero s ah est http auth hdr ah function free element http authent header structur est destroy ah est http auth hdr ah len ah ah user free ah user ah pwd length password zeroiz len strnlen s ah pwd max uidpwd len memzero s ah pwd len free ah pwd ah uri free ah uri ah cnonc free ah cnonc ah qop free ah qop ah nc free ah nc ah nonc free ah nonc ah respons free ah respons ah auth token len strnlen s ah auth token max auth token len len memzero s ah auth token len free ah auth token free ah function verifi peer provid certif verif tls stack http authent credenti provid return est auth state author result est auth state est enrol auth est ctx ctx http ctx ssl ssl path seg reenrol est auth state rv est unauthor x peer null mg connect conn mg connect http ctx est http auth hdr ah est http auth hdr result pr v result client certif tls stack peer ssl peer certif ssl null check tls base client author client cert author v result ssl verifi result ssl x v ok v result est log info `` tls client certif valid rv est cert auth x v err unabl crl v result est log warn `` peer cert valid crl load unabl determin peer cert revok `` rv est cert auth est log info `` tls client certif verifi v result d v result need bail client use bogus cert need contiu http authent x free peer est unauthor est log info `` tls peer certif rv est unauthor srp use certif rv est cert auth ssl srp usernam ssl null est log info `` tls certif client srp login s ssl srp usernam ssl rv est srp auth applic layer enabl http authent attempt http authent tls client auth fail http auth flag set applic assum applic layer provid http auth callback facil ctx est http auth cb rv est unauthor http auth requir ctx http auth tri http authent ah est creat ah pr mg pars auth header conn ah pr est auth hdr good invok applic specif auth check user s credenti ctx est http auth cb ctx ah peer path seg ctx ex data rv est http auth est log warn `` http authent fail auth type d ah mode rv est unauthor est auth hdr miss ask client send author header mg send author request conn est log info `` http auth header miss send http auth request client `` rv est http auth pend est auth hdr bad est log warn `` client sent incomplet http author header reenrol rv est cert auth est log info `` client cert authent http auth requir reenrol rv est unauthor est destroy ah ah peer x free peer rv function use determin est client ra use certif contain id kp cmc ra usag extens usag bit present po p check disabl allow ra use logic taken xv cach extens v purp c open ssl return cert contain id kp cmc ra extend key usag extens return est check cmc ra x cert cmc ra extend key usag extusag asn object obj extend key usag extens loop valu look ik kp cmc ra valu extens extusag x ext di cert nid ext key usag null null iter extend key usag valu sk asn object num extusag obj sk asn object valu extusag compar current iter global id kp cmc ra valu creat earlier obj cmp obj o cmc ra cmc ra sk asn object pop free extusag asn object free cmc ra util function convert base der encod csr open ssl x req pointer return null problem x req est server pars csr pkcs pkcs len bio b x req req origin pkcs request client b bio new bio f base b null est log err `` unabl open pkcs b buffer null bio new mem buf pkcs pkcs len null est log err `` unabl open pkcs raw buffer bio free b null bio push b read pem encod pkcs cert request req di x req bio null null est log err `` problem read der encod certif request ossl dump ssl error bio free null bio free req function implement proof posess check po p tls uid save tls session earlier tls uid match valu challeng password attribut pkcs client certif client provid valu sign pkcs cert request privat key prove client possess privat key check enforc follow csr contain po p valid csr did nt contain po p server configur po p authent fail csr did nt contain po p server configur po p authent pass paramet ctx pointer est context ssl pointer ssl context pkcs pointer raw pkcs data pkcs len length raw pkcs data valu est err po p check pass est tls uid auth est ctx ctx ssl ssl x req req x attribut attr j asn type asn bit string bs null asn type t rv est err tls uid diff index challeng password attribut request x req attr nid req nid pkcs challeng password est log info `` cert request doe contain po p challeng password attribut po p enabl fail point client did nt send channel bind info csr ctx server enabl pop est log warn `` po p enabl csr authent est err auth fail tlsuid est err refer attribut know s locat rfc requir check po p s present attr x req attr req attribut actual valu challeng password attr attr singl t attr valu singl bs t valu bit string j sk asn type valu attr valu set j bs valu asn string est log warn `` po p challeng password attribut client cert request est err auth fail tlsuid challeng password client cert request compar tls uid calcul server implement po p check verifi client hold privat key use sign cert request tls uid est tls uid ssl tls uid memcmp s tls uid est tls uid len bs data est tls uid len diff eok diff est log info `` po p valid rv est err est log warn `` po p valid rv est err auth fail tlsuid free tls uid est log warn `` local tls channel bind info avail rv est err auth fail tlsuid rv function perform simpl saniti check pkcs csr check signatur csr return success non zero saniti check fail est server check csr x req req evp pkey pub key null rc extract public key csr pub key x req pubkey req null est log err `` unabl extract public key csr verifi signatur csr rc x req verifi req pub key evp pkey free pub key check result rc est log err `` csr signatur check fail rc est log err `` csr signatur mismatch free link list contain attribut client csr est server free csr oid list est oid list head est oid list entri head entri head entri free head head entri entri head free head add new entri tail list attribut client csr est server add oid list est oid list list est oid list new entri est oid list head list list doe nt head new entri simpli head head null list new entri walk list tail add new entri end head head head head new entri recurs routin walk asn blob look asn object definit oid object ad est oid list argument end result routin list contain oid valu asn object blob code shameless taken open ssl an pars explain poor chosen variabl name est server csr asn pars est oid list list blob length offset est oid list new entri ptr ep tot op opp len tag xclass hl j r asn object object null errno t safec rc ptr blob tot ptr length op ptr ptr tot op ptr op ptr j asn object ptr len tag xclass length j x est log err `` error encod blob ptr hl ptr op length hl j v asn construct ep ptr len len length est log err `` length greater ld length blob ptr j x len r est server csr asn pars list ptr tot ptr offset ptr blob r blob ptr r ptr tot ptr ep r est server csr asn pars list ptr len offset ptr blob r blob ptr xclass ptr len tag v asn object opp op di asn object object opp lenhl null new entri malloc est oid list new entri est log err `` malloc failur est server free csr oid list list object null asn object free object blob ptr safec rc memset s new entri est oid list x est oid list safec rc eok est log info `` memset s error x x o\\n safec rc asn object new entri oid est max attr len object est log info `` build csr oid list s new entri oid est server add oid list list new entri object null asn object free object object null est log err `` bad asn object object null asn object free object blob ptr ptr len tag v asn eoc xclass blob ptr length len blob ptr util function popul link list contain oid attribut present client csr est error est server build csr oid list est oid list list bodi bodi len der data der ptr der len rv grab space hold decod csr data der ptr der data malloc bodi len der data est log err `` malloc fail est err malloc decod csr data der len est base decod bodi der data bodi len der len est log err `` invalid base encod data free der data est err bad base rv est server csr asn pars list der data der len rv est log err `` fail build oid list client provid csr est server free csr oid list list free der ptr est err unknown free der ptr est err function check local configur csr attribut attribut csr attribut miss csr error return est error est server csrattr present est ctx ctx bodi bodi len tag xclass j match nid len der ptr save ptr asn object object max len max csrattr csr data csr len len save der data der len len len tbuf  est max attr len  est oid list csr attr oid null est oid list oid entri compar est error rv est log info `` csr attribut enforc enabl ctx server csrattr ctx est csr cb est log warn `` csr attribut enforc enabl attribut configur est err build list attribut present csr list use later confirm requir attribut present rv est server build csr oid list csr attr oid bodi bodi len rv est err rv csr attribut configur server ll need look csr make sure csr provid use callback configur use local copi ctx est csr cb csr data ctx est csr cb csr len null ctx ex data csr data est log err `` applic layer fail csr attribut est server free csr oid list csr attr oid est err cb fail csr data malloc ctx server csrattr len csr data est log err `` malloc failur est server free csr oid list csr attr oid est err malloc strncpi s csr data ctx server csrattr len ctx server csrattr ctx server csrattr len csr data  ctx server csrattr len  csr len ctx server csrattr len est log info `` check csr attr present csr s csr data csr configur server need base decod check smallest possibl base saniti test check min max valu asn data csr len min csrattr est server free csr oid list csr attr oid free csr data est err invalid paramet grab space hold decod csr data der data malloc csr len der data est log err `` malloc fail est server free csr oid list csr attr oid free csr data est err malloc decod csr data der len est base decod csr data der data csr len free csr data der len est log err `` invalid base encod data est server free csr oid list csr attr oid free der data est err bad base pointer fun start joy open ssl len save len der len der ptr save ptr der data len save max len est log err `` der length exceed max est server free csr oid list csr attr oid free der data est err invalid paramet make sure asn der len min asn csrattr est log err `` der est server free csr oid list csr attr oid free der data est err invalid paramet iter csr attribut configur server len attribut j asn object der ptr len tag xclass len est log info `` saniti tag d len d j d len d tag len j len j x est log err `` bad asn hex est server free csr oid list csr attr oid free der data est err bad asn hex tag v asn object object ci asn object null der ptr len object est log err `` object null est server free csr oid list csr attr oid free der data est err unknown challeng password need check cover authent client nid obj objnid object nid nid pkcs challeng password asn object free object len asn object tbuf est max attr len object est log info `` look attr s csr tbuf asn object free object attrubut csr bail csr attr oid null est log warn `` csr did contain attribut csr reject tbuf free der data est err csr attr miss match oid entri csr attr oid iter attribut csr oid entri est log info `` compar s s tbuf oid entri oid strcmp s oid entri oid len est max attr len len est max attr len tbuf compar compar match oid entri oid entri match est log warn `` csr did contain s attribut csr reject tbuf est server free csr oid list csr attr oid free der data est err csr attr miss adjust string pointer item der ptr len v asn set v asn sequenc len len save der ptr save ptr file check ensur did nt miss pars local configur csr attribut len est log err `` der length zero d len est server free csr oid list csr attr oid free der data est err bad asn hex lucki make far mean local configur csr attribut client s csr est server free csr oid list csr attr oid free der data est err function use server process incom simpl enrol request client est error est handl simpl enrol est ctx ctx http ctx ssl ssl ct bodi bodi len path seg reenrol rv cert len mg connect conn mg connect http ctx cert http hdr  est http hdr max  hdrlen x peer cert x req csr null client ra reenrol ctx est enrol pkcs cb est log err `` null enrol callback est err null callback reenrol ctx est reenrol pkcs cb est log err `` null reenrol callback est err null callback make sure client sent pkcs csr request strncmp ct `` applic pkcs est err bad content type authent client est enrol auth ctx http ctx ssl path seg reenrol est http auth est srp auth est cert auth mean user author http authorizt certif author est http auth pend est err auth pend est unauthor est err auth fail pars pkcs csr client csr est server pars csr bodi bodi len csr est log err `` unabl pars pkcs csr sent client est err bad pkcs perform saniti check csr est server check csr csr est log err `` pkcs csr sent client fail saniti check x req free csr est err bad pkcs peer certif avail identifi client ca desir inform peer cert ssl peer certif ssl peer cert client ra est check cmc ra peer cert est log info `` id kp cmc ra present d client ra po p check proof possess challeng password pkcs request match tls uniqu id po p check performend client ra client ra rv est tls uid auth ctx ssl csr rv est err x req free csr x free peer cert est err auth fail tlsuid check need ensur client includ csr attribut requir ca ctx enforc csrattr est err est server csrattr present ctx bodi bodi len x req free csr x free peer cert est err csr attr miss bodi point pkcs data pass enrol routin reenrol rv ctx est reenrol pkcs cb bodi bodi len cert cert len conn user id peer cert path seg ctx ex data rv ctx est enrol pkcs cb bodi bodi len cert cert len conn user id peer cert path seg ctx ex data peer cert longer need delet peer cert x free peer cert rv est err cert len send http header snprintf http hdr est http hdr max `` s s s s est http hdr_ est http hdr eol est http hdr stat_ est http hdr eol hdrlen strnlen s http hdr est http hdr max snprintf http hdr hdrlen est http hdr max `` s s s est http hdr ct est http ct pkcs est http hdr eol hdrlen strnlen s http hdr est http hdr max snprintf http hdr hdrlen est http hdr max `` s s s est http hdr ce est http ce base est http hdr eol hdrlen strnlen s http hdr est http hdr max snprintf http hdr hdrlen est http hdr max `` s d s s est http hdr cl cert len est http hdr eol est http hdr eol mg write http ctx http hdr strnlen s http hdr est http hdr max free cert x req free csr est err http write send pkcs certif bodi mg write http ctx cert cert len free cert x req free csr est err http write free cert rv est err ca enrol retri ca did sign request ask client retri futur occur ca configur automat enrol send http retri respons client est log info `` ca server request retri possibl s setup enrol est err est server send http retri ctx http ctx ctx retri period x req free csr est err http write x req free csr est err ca enrol fail x req free csr est err function use server process incom csr attribut request client est handl csr attr est ctx ctx http ctx path seg rv est err pop present csr data csr data pop csr len csr pop len ctx server csrattr ctx est csr cb ctx server enabl pop est log err `` null csr callback send respons indic server doe nt csr est send http error ctx http ctx est err http content est err csr data malloc est csrattr pop len csr data est err malloc strncpi s csr data est csrattr pop len est csrattr pop est csrattr pop len csr data  est csrattr pop len  csr len est csrattr pop len est send csrattr data ctx csr data csr len http ctx invok ca server callback retriev csr callback take prioriti save valu context note need authent client sec ctx est csr cb csr data ctx est csr cb csr len path seg ctx ex data rv est asn pars attribut csr data csr len pop present csr len rv est err csr data free csr data est send http error ctx http ctx est err http content est err ctx csr pop present ctx server enabl pop rv est challeng password present csr data csr len pop present rv est err est log err `` error po p saniti check csr data free csr data est send http error ctx http ctx est err http content est err ctx csr pop present pop present ctx csr pop present csr len csr data malloc est csrattr pop len csr data est err malloc strncpi s csr data est csrattr pop len est csrattr pop est csrattr pop len csr data  est csrattr pop len  csr len est csrattr pop len est send csrattr data ctx csr data csr len http ctx rv est add challeng password csr data csr len csr data pop csr pop len rv est err csr data free csr data est log err `` error add po p est send http error ctx http ctx est err http content est err free csr data csr data csr data pop csr len csr pop len csr data malloc ctx server csrattr len csr data est err malloc strncpi s csr data ctx server csrattr len ctx server csrattr ctx server csrattr len csr data  ctx server csrattr len  csr len ctx server csrattr len est send csrattr data ctx csr data csr len http ctx function call web server layer http request arriv listen port est server determin est request type dispatch request appropri handler paramt ctx pointer est ctx http ctx context pointer web server method html method request `` `` post uri pointer http uri bodi pointer html bodi content bodi len length html bodi ct html content type header est http request est ctx ctx http ctx method uri bodi bodi len ct ssl ssl rc est oper oper path seg est error rv est err ctx est log err `` null context est err ctx verifi context server client ctx est mode est server est err bad mode rv est pars uri uri oper path seg rv est err est send http error ctx http ctx rv rv cacert request oper est op cacert allow strncmp method `` est send http error ctx http ctx est err wrong method free path seg path seg null est err wrong method rc est handl cacert ctx ctx ca cert ctx ca cert len http ctx path seg rc est server handl cacert ctx http ctx path seg rc est server handl cacert ctx http ctx path seg rc est err est send http error ctx http ctx rc free path seg path seg null rc simpl enrol request oper est op simpl enrol post allow strncmp method `` post est log warn `` incom http request use wrong method\\n est send http error ctx http ctx est err wrong method free path seg path seg null est err wrong method ct est log warn `` incom http header content type header\\n est send http error ctx http ctx est err bad pkcs free path seg path seg null est err bad content type ssl context requir authent client ssl ssl mg conn ssl http ctx ssl est send http error ctx http ctx est err ssl ctx free path seg path seg null est err ssl ctx rc est handl simpl enrol ctx http ctx ssl ct bodi bodi len path seg rc est err rc est err auth pend est log warn `` enrol fail rc d s \\n rc est err num str rc rc est err auth fail est send http error ctx http ctx est err auth fail est send http error ctx http ctx est err bad pkcs free path seg path seg null rc enrol request oper est op simpl reenrol post allow strncmp method `` post est log warn `` incom http request use wrong method\\n est send http error ctx http ctx est err wrong method free path seg path seg null est err wrong method ct est log warn `` incom http header content type header\\n est send http error ctx http ctx est err bad pkcs free path seg path seg null est err bad content type ssl context requir authent client ssl ssl mg conn ssl http ctx ssl est send http error ctx http ctx est err ssl ctx free path seg path seg null est err ssl ctx rc est handl simpl enrol ctx http ctx ssl ct bodi bodi len path seg rc est err rc est err auth pend est log warn `` reenrol fail rc d s \\n rc est err num str rc rc est err auth fail est send http error ctx http ctx est err auth fail est send http error ctx http ctx est err bad pkcs free path seg path seg null est err bad pkcs keygen request fixm current implement strncmp uri est keygen uri est uri max len post allow strncmp method `` post est log warn `` incom http request use wrong method\\n est send http error ctx http ctx est err wrong method est err wrong method ct est log warn `` incom http header content type header\\n est err bad content type est handl keygen ctx est send http error ctx http ctx fixm param zero est err http write fixm need appropri code endif csr attribut request oper est op csrattr allow strncmp method `` est log warn `` incom http request use wrong method\\n est send http error ctx http ctx est err wrong method free path seg path seg null est err wrong method rc est handl csr attr ctx http ctx path seg rc est err est send http error ctx http ctx rc free path seg path seg null rc send error uri did nt match est send http error ctx http ctx est err http free path seg path seg null est err brief est server start use applic start est server est server init call requir callback function provid applic param ctx pointer est context lib est use http code mongoos http server function allow applic start http servic layer requir est est error est error est server start est ctx ctx est mg context mgctx ctx est log err `` null context est err ctx mgctx mg start ctx mgctx ctx mg ctx mgctx est err est err ssl ctx brief est server stop use applic stop est server call prior est destroy param ctx pointer est context lib est use http code mongoos http server function allow applic stop http servic layer est error est error est server stop est ctx ctx est mg context mgctx ctx est log err `` null context est err ctx mgctx est mg context ctx mg ctx mgctx mg stop mgctx est err brief est server init use applic creat context est librari oper est server front ca context use invok function api param ca chain array contain pem encod ca cert crl entri param ca chain len length ca chain array param cacert resp chain array contain pem encod ca cert includ cacert respons param cacert resp chain len length cacert resp chain array param cert format specifi encod local extern certif chain pem der param http realm array contain http realm http auth param tls id cert pointer x contain server s certif tls layer param tls id key pointer evp pkey contain privat key associ server s certif function allow applic initi est server context use ca ra applic provid trust ca certif use server oper use ca chain paramet certif set includ explicit trust anchor certif number implicit trust anchor certif intermedi sub ca certif requir complet chain trust ident certif pass tls id cert paramet root certif ident certif ca certif encod use format specifi cert format paramet e g pem contain crl entri use authent est client connect server applic provid http realm use http authent server cerif privat key use tls stack identifi server warn includ addit intermedi sub ca certif need complet chain trust result potenti mitm attack est ctx est ctx est server init ca chain ca chain len cacert resp chain cacert resp chain len est cert format cert format http realm x tls id cert evp pkey tls id key est ctx ctx len est log version saniti check input ca chain null est log err `` trust ca certif set null cert format est cert format pem est log err `` pem encod certif chang support `` null check length valu match len strnlen s ca chain est ca max len ca chain len est log err `` length ca chain doe nt match ca chain len null cacert resp chain len strnlen s cacert resp chain est ca max len cacert resp chain len est log err `` actual length cacert resp chain doe match `` `` pass length valu null tls id cert null est log err `` tls ident cert null tls id key null est log err `` privat key associ tls ident cert null http realm null est log err `` est http realm null null ctx malloc est ctx ctx est log err `` malloc fail null memzero s ctx est ctx ctx est mode est server ctx retri period est retri period def ctx http auth http auth requir ctx server read timeout est ssl read timeout def load ca certif local memori retain futur use use cacert request paramet altern app layer provid callback fli cacert resp chain est load ca cert ctx cacert resp chain cacert resp chain len est log err `` fail load ca certif respons buffer free ctx null est load trust cert ctx ca chain ca chain len est log err `` fail load trust certfic store free ctx null strncpi s ctx realm max realm http realm max realm ctx server cert tls id cert ctx server priv key tls id key ctx auth mode auth basic ctx server enabl pop ctx local cacert process creat new asn object id kp cmc ra oid open ssl doe nt defin need creat http www openssl org doc crypto obj nidobj html o cmc ra o cmc ra obj txtobj `` o cmc ra est log warn `` fail creat oid id kp cmc ra key usag check ctx brief est server set auth mode use applic configur http authent method use valid ident est client param ctx pointer est context param amod follow auth basic auth digest auth token function option invok applic chang http authent mode mode http basic authent applic desir use digest token authent instead function use set mode function invok prior start est server est error est error est server set auth mode est ctx ctx est http auth mode amod ctx est log err `` null context est err ctx amod auth digest http digest auth use md make sure fip mode fip mode est log err `` http digest auth allow fip mode est err bad mode fallthrough auth basic auth token ctx auth mode amod est err est log err `` unsupport http authent mode basic digest token allow est err bad mode brief est set ca enrol cb use applic instal handler sign incom pkcs request param ctx pointer est context param cb function address handler function call prior start est server callback function match follow prototyp func x function call lib est certif request need ca server applic need forward request sign author respons respons pkcs certif est error est error est set ca enrol cb est ctx ctx cb pkcs p len pkcs pkcs len user id x peer cert path seg ex data ctx est log err `` null context est err ctx ctx est enrol pkcs cb cb est err brief est set ca reenrol cb use applic instal handler enrol certif param ctx pointer est context param cb function address handler function call prior start est server callback function match follow prototyp func x function call lib est certif need renew ca server applic need forward request sign author respons respons pkcs certif est error est error est set ca reenrol cb est ctx ctx cb pkcs p len pkcs pkcs len user id x peer cert path seg ex data ctx est log err `` null context est err ctx ctx est reenrol pkcs cb cb est err brief est set http auth cb use applic instal handler authent est client param ctx pointer est context param cb function address handler function call prior start est server callback function match follow prototyp cb est ctx ctx est http auth hdr ah x peer cert path seg ex data function call lib est perform http authent lib est pass est http auth hdr applic allow applic hook radius aaa user authent databas x certif tls peer est client provid callback facil allow applic layer check specif attribut x certif ar devic id addit path segment string pass request uri est error est error est set http auth cb est ctx ctx cb est ctx ctx est http auth hdr ah x peer cert path seg ex data ctx est log err `` null context est err ctx ctx est http auth cb cb est err brief est set http auth requir use applic defin http authent requir addit use client certif param ctx pointer est context param requir flag indic http authent requir set http auth requir valu http auth set http auth requir http auth occur tls client authent fail est error mode http auth requir mean http authent attempt tls client authent succeed http authent need tls client auth fail set http auth requir est error est set http auth requir est ctx ctx est http auth requir requir ctx est log err `` null context est err ctx ctx http auth requir est err brief est server enabl srp use applic enabl tls srp authent allow est client provid srp credenti tls layer authent est server function invok enabl server srp support param ctx pointer est context param cb function address applic specif srp verifi handler function invok prior start est server use specifi handler srp authent tls layer tls srp cipher suit negoti tls layer handler invok lib est retriev srp paramet user authent applic provid srp paramet user handler use follow logic invok ssl srp usernam srp user tls layer lookup user s srp paramet applic specif user databas paramet includ n g s v paramet invok ssl set srp server param forward srp paramet tls layer allow tls handshak proceed lib est includ exampl server applic use handler srp support exampl use open ssl srp verifi file capabl manag srp paramet individu user applic use approach util facil manag user specif srp paramet refer rfc rfc understand srp est error est error est server enabl srp est ctx ctx cb ssl s ad arg ctx est log err `` null context est err ctx cb est log err `` null callback est err invalid paramet ctx est srp usernam cb cb ctx enabl srp est err brief est server enabl pop use applic enabl proof possess check est server prove est client sent csr server posses privat key use sign csr bind tls session id csr note csr attribut configur server po p check need function enabl po p po p enabl automat scenario note po p check possibl est proxi use est client est server proxi possess privat key est server woul fail po p check est proxi enabl featur ensur est client sign key param ctx pointer est context function call time est error est error est server enabl pop est ctx ctx ctx est log err `` null context est err ctx ctx server enabl pop est err brief est server disabl pop use applic disabl proof possess check est server documen est server enabl pop inform proof possess check param ctx pointer est context function call time est error est error est server disabl pop est ctx ctx ctx est log err `` null context est err ctx ctx server enabl pop est err brief est server set retri period use applic chang retri period sent est client ca server configur enrol retri valu notifi client wait attempt enrol oper ca approv origin csr param ctx pointer est context param second number second server use retri respons function call time context creat est error est error est server set retri period est ctx ctx second ctx est log err `` null context est err ctx second est retri period max est log err `` maximum retri period d second est retri period max est err invalid paramet second est retri period min est log err `` minimum retri period d second est retri period min est err invalid paramet ctx retri period second est err brief est server set ecdh curv use applic specifi ecc curv use ephemer diffi hellman key tls handshak ephemer diffi hellman enabl lib est provid better forward secreci curv specifi applic use function primev curv use curv param ctx pointer est context param nid open ssl nid valu desir curv function call prior start est server nid valu defin openssl obj mac h typic nid valu provid function includ nid x_ primev nid x_ primev nid secpr nid secpr est error est error est server set ecdh curv est ctx ctx nid ctx est log err `` null context est err ctx nid est log err `` invalid nid valu est err invalid paramet ctx ecdh nid nid est err brief est server set dh parm use applic specifi diffi hellman paramet use singl use dh key generat tls handshak paramet use singl use dh key generat enabl enabl improv forward secreci tls handshak oper dh paramet provid api hard code applic paramet generat time product instal reus paramet multipl instal product result vulner product param ctx pointer est context param parm pointer open ssl dh paramet function call prior start est server est error est error est server set dh parm est ctx ctx dh parm ctx est log err `` null context est err ctx parm est log err `` null dh paramet est err invalid paramet ctx dh tmp dhparam dup parm est err brief est server init csrattr use applic initi fix set csr attribut attribut use lib est respons client csr attribut request attribut asn base encod charact string param ctx pointer est context param csrattr pointer csr attribut asn base encod format null pointer clear attribut length param csrattr len length csr attribut charact string est csr cb callback function maintain precend method csr attribut est csr cb initi applic use lib est use attribut initi function call prior start est server po p configur est server enabl pop est server disabl pop call prior function est error est error est server init csrattr est ctx ctx csrattr csrattr len csrattr pop len pop present rv csrattr data pop null ctx null est err ctx verifi context server client proxi ctx est mode est server est err bad mode est log info `` attribut pointer p len d ctx server csrattr ctx server csrattr len free old version previous initi ctx server csrattr null free ctx server csrattr ctx server csrattr null ctx server csrattr len caller just want clear csrattr null est err order run client negat unit test paramet po p pars check need disabl defin coupl place check smallest possibl base saniti test check min max valu asn data csrattr len min csrattr est err invalid paramet assum po p csr attribut ctx csr pop present ctx server enabl pop rv est challeng password present csrattr csrattr len pop present rv est err est log err `` error po p saniti check est err invalid paramet ctx csr pop present pop present ctx csr pop present rv est add challeng password csrattr csrattr len csrattr data pop csrattr pop len rv est err est log err `` error add po p est err invalid paramet csrattr csrattr data pop csrattr len csrattr pop len rv est asn pars attribut csrattr csrattr len pop present rv est err est log err `` corrupt csr attribut est err invalid paramet ctx server csrattr malloc csrattr len ctx server csrattr csrattr data pop free csrattr data pop est err malloc ctx server csrattr len csrattr len strncpi s ctx server csrattr csrattr len csrattr csrattr len ctx server csrattr  csrattr len  csrattr data pop free csrattr data pop est log info `` attribut pointer p len d ctx server csrattr ctx server csrattr len est err brief est server enabl tls deprec function tls violat rfc longer support est librari function log error messag est err bad mode param ctx pointer est context function call prior start est server est error est error est server enabl tls est ctx ctx est log err `` tls violat rfc support est err bad mode brief est server enforc csrattr use applic enabl check csr attribut est server enabl est client provid csr attribut csrattr respons sent server enrol fail client fail provid csr attribut set appli simpl enrol reenrol oper set appli server mode bear proxi mode oper param ctx pointer est context function call prior start est server est error est error est server enforc csrattr est ctx ctx ctx est log err `` null context est err ctx ctx enforc csrattr est err brief est server set read timeout use applic set timeout valu server read oper socket open est server begin attempt read socket timeout valu limit time client wait respons valu set est ssl read timeout def param ctx pointer est context param timeout integ valu repres read timeout second minimum valu est ssl read timeout min maximum valu est ssl read timeout max est error est error est server set read timeout est ctx ctx timeout ctx est log err `` null context est err ctx timeout est ssl read timeout min timeout est ssl read timeout max est log err `` invalid read timeout valu pass d `` timeout est err invalid paramet ctx server read timeout timeout est err
 util function set certif privat key use ssl context return success est client set cert key ssl ctx ctx x cert evp pkey key ssl ctx use certif ctx cert est log err `` error set certif ossl dump ssl error ssl ctx use privat key ctx key est log err `` unabl set privat key ossl dump ssl error verifi key match cert ssl ctx check privat key ctx est log err `` privat key doe match certif public key ossl dump ssl error sign x certif request use digest key pass return open ssl error code x req sign ctx est client x req sign x req x evp pkey pkey evp md md rv evp pkey ctx pkctx null evp md ctx mctx evp md ctx init mctx evp digest sign init mctx pkctx md null pkey encod use der asn set modifi flag x req open ssl keep cach copi der encod data case set flag tell open ssl run asn encod use cach copi x req info enc modifi rv x req sign ctx x mctx evp md ctx cleanup mctx rv popul x request build x request buffer doe call open ssl insert field x header paramet req pointer buffer hold x request header pkey public key place x request cn common place x request cp challeng password place x header valu est err success est error popul x request est ctx ctx x req req evp pkey pkey cn cp x subj setup version number x req set version req l est log err `` unabl set x version ossl dump ssl error est err x ver add common entri subj x req subject req x add entri txt subj `` cn mbstring asc cn est log err `` unabl set x common ossl dump ssl error est err x cn add challeng password attribut requir need remov add attribut po p simpl enrol flow ctx csr pop requir ctx client forc pop est log info `` client includ challeng password csr x req add attr nid req nid pkcs challeng password mbstring asc cp est log err `` unabl set x challeng password attribut ossl dump ssl error est err x attr set public key request x req set pubkey req pkey est log err `` unabl set public key ossl dump ssl error est err x pubkey est err function generat pkcs request paramet cn common certif cp tls uniqu id ssl session challeng password pkey privat key use sign request valu est err success est error est generat pkcs est ctx ctx cn cp evp pkey pkey x req pkcs x req req null est error rv ossl rv req x req new req null est log err `` unabl alloc x req ossl dump ssl error est err malloc rv popul x request ctx req pkey cn cp rv est err x req free req rv sign request ossl rv est client x req sign req pkey ctx sign digest ossl rv est log err `` unabl sign x cert request x req free req ossl dump ssl error est err x sign pkcs req est err function callback use open ssl s verifi cert function s call end cert verif allow opportun gather inform regard fail cert verif possibl chang result verif callback similar ossl routin doe alter verif result est client cacert verifi cb ok x store ctx ctx cert error x store ctx error ctx x current cert x store ctx current cert ctx est log info `` enter function ok d cert error d ok cert error ok current cert x print ex fp stdout x subject current cert xn flag onelin printf `` \\n est log info `` s error d d depth lookup s\\n x store ctx parent ctx ctx ``  crl path  `` cert error x store ctx error depth ctx x verifi cert error string cert error ok function remov crls receiv cacert respons buffer paramet ctx est context repres session cacert pointer buffer hold result ca cert cacert len length cacert buffer p pointer pkcs buffer receiv valu est err success est error est client remov crls est ctx ctx cacert cacert len pkcs p nid crls bio b enc null bio pbio null new cacert len new cacert buf null count nid obj objnid p type nid nid pkcs p d sign crl sk x crl pop free p d sign crl x crl free p d sign crl null crls nid pkcs envelop p d envelop crl sk x crl pop free p d envelop crl x crl free p d sign crl null crls est log err `` invalid nid valu pkcs structur est err cacert verif crls remov origin pkcs buffer need updat base encod alloc bio write pkcs pem format pointer length new base pem encod buffer copi origin buffer pass crls remov new buffer shorter fit origin buffer crls est log info `` crl s attach ca certif remov crl s b enc bio new bio f base b enc null est log err `` bio new fail ossl dump ssl error est err malloc pbio bio new bio s mem pbio null est log err `` unabl access ca cert buffer ossl dump ssl error est err malloc pbio bio push b enc pbio memzero s cacert cacert len count id pkcs bio pbio p count est log err `` pem write bio pkcs fail ossl dump ssl error bio free pbio est err cacert verif bio flush pbio bio mem data just return pointer length data contain mem bio alloc pass new cacert len bio mem data pbio new cacert buf new cacert len est log err `` fail copi pkcs data ossl dump ssl error bio free pbio est err cacert verif copi new buffer old buffer memcpi s cacert cacert len new cacert buf new cacert len cacert len new cacert len bio free pbio est err function decod pass base encod buffer decod cacert return est err caller respons free cacert decod buffer est error b decod cacert cacert cacert len cacert decod cacert decod len bio null bio b null decod buf decod buf len cacert decod null cacert decod len b bio new bio f base b null est log err `` bio new fail ossl dump ssl error est err malloc decod origin buffer bio new mem buf cacert cacert len null est log err `` unabl access ca cert buffer ossl dump ssl error bio free b est err malloc bio push b decod buf malloc cacert len decod buf null est log err `` unabl alloc ca cert buffer decod bio free est err malloc decod buf len bio read decod buf cacert len cacert decod decod buf cacert decod len decod buf len bio free est err return est err caller respons free pkcs est error creat pkcs cacert decod cacert decod len pkcs pkcsout bio pbio null pkcs pkcs null pkcs format buffer certif read stack x cert pbio bio new mem buf cacert decod cacert decod len pbio null est log err `` unabl access pkcs buffer ossl dump ssl error est err malloc pkcs di pkcs bio pbio null pkcs null est log err `` unabl read pkcs base certif buffer ossl dump ssl error bio free pbio est err load cacert bio free pbio pkcsout pkcs est err function invok cacert respons receiv cert chain built cert store certif verifi store essenti verifi cert chain ensur intermedi verifi includ root cert cacert respons crls attach remov new pkcs buffer creat paramet ctx est context repres session cacert pointer buffer hold receiv ca cert cacert len length cacert buffer valu est err success est error verifi cacert resp est ctx ctx cacert cacert len rv fail est error est rc est err x store trust cacert store null stack x stack null x current cert null cacert decod null cacert decod len x store ctx store ctx null pkcs pkcs null ctx null cacert null cacert len est log err `` invalid paramet ctx x cacert x cacert len x ctx cacert cacert len est err invalid paramet base decod incom ca cert buffer convert pkcs structur extract stack cert rv b decod cacert cacert cacert len cacert decod cacert decod len rv est err est log err `` base decod receiv ca cert fail rv rv creat pkcs cacert decod cacert decod len pkcs rv est err est log err `` fail build pkcs structur receievd buffer free cacert decod rv rv pkcs stack pkcs stack rv est err est log err `` obtain stack ca cert pkcs structur free cacert decod pkcs free pkcs rv point stack x cert make ca cert respons sent est server build store `` trust cert use verifi walk cert verifi build store context store cert verifi verifi function trust cacert store x store new trust cacert store null est log err `` unabl alloc cert store ossl dump ssl error free cacert decod pkcs free pkcs est err malloc x store set verifi cb trust cacert store est client cacert verifi cb sk x num stack current cert sk x valu stack self add trust store add untrust store rv x check issu current cert current cert rv x v ok est log info `` ad cert trust store s current cert x store add cert trust cacert store current cert set x store context store ctx x store ctx new store ctx null est log err `` unabl alloc new store context ossl dump ssl error free cacert decod pkcs free pkcs x store free trust cacert store est err malloc sk x num stack x store ctx init store ctx trust cacert store null stack est log err `` unabl initi new store context ossl dump ssl error free cacert decod pkcs free pkcs x store free trust cacert store x store ctx free store ctx est err malloc current cert sk x valu stack est log info `` ad cert store s current cert x store ctx set cert store ctx current cert rv x verifi cert store ctx rv cert fail verif log est log warn `` certif fail verif s current cert fail final remov crls attach est rc est client remov crls ctx cacert cacert len pkcs free cacert decod x store free trust cacert store x store ctx free store ctx pkcs free pkcs fail est err cacert verif est rc function regist ssl call verif certif server s ident cert chain main purpos look cert verifi est client app regist callback receiv untrust cert forward est client applic paramet ok status certif ssl verifi code x ctx ptr x certif store structur valu potenti modifi status process certif cane modifi et client applic ve provid callback allow process modifi callback cert verifi cb ok x store ctx x ctx ssl ssl est ctx e ctx approv cert error x current cert null approv ok x ctx null est log err `` invalid x context pointer approv cert error x store ctx error x ctx current cert x store ctx current cert x ctx est log info `` enter cert pass open ssl error d s \\n cert error x verifi cert error string cert error retriev pointer ssl structur connect applic specif data store ssl object est ctx est session e ctx ssl exdata index ssl exdata index invalid est log err `` invalid ssl exdata index est context valu approv ssl x store ctx ex data x ctx ssl ex data x store ctx idx ssl est log err `` null pointer retriev ssl session pointer x ctx ex data approv e ctx ssl ex data ssl e ctx ssl exdata index e ctx est log err `` null pointer retriev est context ssl ex data approv ok cert error case notifi client applic cert untrust expect verifi server s cert self cert chain current result server verifi cert unabl crl pass make sure applic know x v err cert untrust x v err self cert chain x v err unabl crl applic provid callback ahead pass cert store log warn ssl gave status e ctx manual cert verifi cb est log info `` est client applic server cert verifi function registered\\n approv e ctx manual cert verifi cb current cert cert error est log info `` est client applic server cert verifi function registered\\n cert error x v err unabl crl ve enabl crl check tls stack applic nt load crl verifi error occur peer s cert valid confirm revok app provid way notifi option log warn proceed est log warn `` crl load tls peer allow `` approv remaind result ok state remain unchang est log warn messag log x v err explicit polici x v err cert expir just check certif ok self warn user x v err depth zero self cert extens error x v err invalid ca x v err invalid non ca x v err path length exceed x v err invalid purpos x v err crl expir x v err crl valid x v err unhandl critic extens x v err cert revok est log warn `` certif verifi fail reason d s cert error x verifi cert error string cert error approv function use creat initi ssl ctx use client proxi est oper ssl ctx store est ctx paramet ctx est context valu est error est err success est error est client init ssl ctx est ctx ctx ssl ctx s ctx x verifi param vpm null est error rv est err est log version ctx null est log err `` invalid context pointer est err ctx s ctx ssl ctx new sslv client method null est log err `` fail obtain new ssl context\\n ossl dump ssl error est err ssl ctx new tls use est ssl ctx set option s ctx ssl op sslv ssl op sslv ssl op tlsv limit cipher suit offer ssl ctx set cipher list s ctx est cipher list est log err `` fail set ssl cipher suites\\n ossl dump ssl error est err ssl cipher list make sure verifi server ssl ctx set verifi s ctx ssl verifi peerssl verifi fail peer cert cert verifi cb leverag cert store creat trust ca chain provid applic ssl stack clean cert store ssl ctx free let s remov refer nt tri clean later ssl ctx set cert store s ctx ctx trust cert store ctx trust cert store null set x param assign ssl ctx enabl crl check max untrust ca cert exist chain ensur cert use intend contain x key usag extens vpm x verifi param new vpm null est log err `` unabl alloc verifi paramet structur ossl dump ssl error est err malloc enabl crl check ctx enabl crl x verifi param set flag vpm x v flag crl check x v flag crl check x verifi param set flag vpm x v flag crl check x v flag crl check x verifi param set depth vpm est tls verifi depth x verifi param set purpos vpm x purpos ssl server ssl ctx set param s ctx vpm x verifi param free vpm save refer ssl session use later match est ctx ssl context est ssl info cb ctx ssl ctx s ctx e ctx ssl exdata index ssl exdata index invalid e ctx ssl exdata index ssl ex new index `` est context null null null config set ctx base instead global entir libcrypto librari need ensur csr string attribut ad ascii printabl format asn string set mask b asn printabl rv function calcul digest valu use http request server ask client use http digest authent use token pars http server respons earlier calcul digest est client generat auth digest est ctx ctx uri user pwd evp md ctx mdctx evp md md evp md uint t ha  evp max md size  ha len ha str  est max md digest str len  uint t ha  evp max md size  ha len ha str  est max md digest str len  nonc cnt   `` digest  evp max md size  d len rv calcul ha use usernam realm password server nonc mdctx evp md ctx creat evp digest init ex mdctx md null est log err `` unabl initi digest null evp digest updat mdctx user strnlen s user max uidpwd evp digest updat mdctx `` evp digest updat mdctx ctx realm strnlen s ctx realm max realm evp digest updat mdctx `` evp digest updat mdctx pwd strnlen s pwd max uidpwd evp digest final mdctx ha ha len evp md ctx destroy mdctx est hex str ha str ha ha len calcul ha use method uri mdctx evp md ctx creat evp digest init ex mdctx md null est log err `` unabl initi digest null evp digest updat mdctx `` post evp digest updat mdctx `` evp digest updat mdctx uri strnlen s uri max realm evp digest final mdctx ha ha len evp md ctx destroy mdctx est hex str ha str ha ha len calcul auth digest use ha nonc nonc count client nonc qop ha mdctx evp md ctx creat evp digest init ex mdctx md null est log err `` unabl initi digest null evp digest updat mdctx ha str ha len evp digest updat mdctx `` evp digest updat mdctx ctx s nonc strnlen s ctx s nonc max nonc evp digest updat mdctx `` evp digest updat mdctx nonc cnt strnlen s nonc cnt max nc evp digest updat mdctx `` evp digest updat mdctx ctx c nonc strnlen s ctx c nonc max nonc evp digest updat mdctx `` evp digest updat mdctx `` auth evp digest updat mdctx `` evp digest updat mdctx ha str ha len evp digest final mdctx digest d len evp md ctx destroy mdctx rv malloc est max md digest str len rv null est log err `` unabl alloc memori digest null est hex str rv digest d len rv est client retriev credenti use retriev credenti server request basic digest mode valu need applic layer mode usernam password api indic mode callback chang est client retriev credenti est ctx ctx est http auth mode auth mode user pwd est http auth hdr auth credenti est http auth cred rc rc reset ctx userid   \\ memzero s ctx userid ctx userid ctx password   \\ memzero s ctx password ctx password need ask applic layer credenti memzero s auth credenti auth credenti ctx auth credenti cb auth credenti mode auth mode rc ctx auth credenti cb auth credenti rc est http auth cred avail est log err `` attempt obtain token applic fail `` did credenti expect point null string generat header auth credenti user null user   \\ max uidpwd strnlen s auth credenti user max uidpwd est log err `` userid provid larger max d max uidpwd user   \\ eok strncpi s user max uidpwd auth credenti user max uidpwd est log err `` invalid user id provid auth credenti pwd null pwd   \\ max uidpwd strnlen s auth credenti pwd max uidpwd est log err `` password provid larger max d max uidpwd pwd   \\ eok strncpi s pwd max uidpwd auth credenti pwd max uidpwd est log err `` invalid user password provid cleans auth credenti auth credenti function add http authent header outgo http request allow server authent est client paramet ctx est context hdr pointer buffer hold header uri pointer buffer hold uri use header est client add auth hdr est ctx ctx hdr uri hdr len digest client random    max uidpwd  uid pwd `` b  max uidpwd  len est http auth hdr auth credenti est http auth cred rc rc token null token b  max auth token len  user  max uidpwd  pwd  max uidpwd  enc len token len memzero s max uidpwd memzero s b max uidpwd hdr len strnlen s hdr est http req total len hdr len est http req total len est log warn `` authent header took maximum buffer d est http req total len ctx auth mode auth basic make sure part credenti send oper origin mode app layer provid need ask app layer ctx userid   \\ ctx password   \\ memzero s user max uidpwd memzero s pwd max uidpwd est client retriev credenti ctx ctx auth mode user pwd regardless come build string contain snprintf max uidpwd `` s s user pwd use given configur est client set auth snprintf max uidpwd `` s s ctx userid ctx password base encod combin string build http auth header len strnlen s max uidpwd enc len est base encod len b max uidpwd enc len est log err `` unabl encod basic auth valu snprintf hdr hdr len est http req total len hdr len `` author basic s\\r\\n b auth digest generat client nonc rand byte client random est log err `` rng failur generat nonc forc hdr null string memzero s hdr est http req total len est hex str ctx c nonc client random check applic layer provid usernam password configur retriev copi local buffer readi ctx userid   \\ ctx password   \\ memzero s user max uidpwd memzero s pwd max uidpwd est client retriev credenti ctx ctx auth mode user pwd eok strncpi s user max uidpwd ctx userid max uidpwd est log err `` invalid user id provid eok strncpi s pwd max uidpwd ctx password max uidpwd est log err `` invalid user password provid digest est client generat auth digest ctx uri user pwd digest null est log err `` error generat digest forc hdr null string memzero s hdr est http req total len memzero s ctx c nonc max nonc memzero s user max uidpwd memzero s pwd max uidpwd snprintf hdr hdr len est http req total len hdr len `` author digest username\\ s\\ realm\\ s\\ nonce\\ s\\ uri\\ s\\ cnonce\\ s\\ nc qop\\ auth\\ response\\ s\\ \\r\\n user ctx realm ctx s nonc uri ctx c nonc digest memzero s digest est max md digest str len memzero s ctx c nonc max nonc memzero s user max uidpwd memzero s pwd max uidpwd free digest auth token est log info `` server request token base authent memzero s auth credenti auth credenti ctx auth credenti cb auth credenti mode auth token rc ctx auth credenti cb auth credenti rc est http auth cred avail est log err `` attempt obtain token applic fail `` did credenti expect point null string generat header auth credenti auth token null est log err `` request token credenti applic did provid `` token `` make sure token given forc null caus auth failur server just credenti provid max auth token len strnlen s auth credenti auth token max auth token len est log err `` token provid larger max d max auth token len token `` token auth credenti auth token base encod combin string build http auth header memzero s token b max auth token len token len strnlen s token max auth token len enc len est base encod token token len token b max auth token len enc len est log err `` unabl encod bearer token auth valu snprintf hdr hdr len est http req total len hdr len `` author bearer s\\r\\n token b cleans auth credenti auth credenti est log info `` http auth mode set send anonym request function use build http header cacert request flow paramet ctx est context hdr pointer buffer hold header est client build cacert header est ctx ctx hdr hdr len snprintf hdr est http req total len `` s s s s http \\r\\n `` user agent s\\r\\n `` connect close\\r\\n `` host s d\\r\\n `` accept \\r\\n est path prefix ctx uri path segment `` ctx uri path segment ctx uri path segment est cacert est http hdr est client ctx est server ctx est port num hdr len strnlen s hdr est http req total len hdr len est http req total len est log warn `` ca cert header took maximum buffer d est http req total len hdr len function use build http header csr attribut request flow paramet ctx est context hdr pointer buffer hold header est client build csr header est ctx ctx hdr hdr len snprintf hdr est http req total len s s s s http \\r\\n `` user agent s\\r\\n `` connect close\\r\\n `` host s d\\r\\n `` accept \\r\\n est path prefix ctx uri path segment `` ctx uri path segment ctx uri path segment est csrattr est http hdr est client ctx est server ctx est port num est client add auth hdr ctx hdr est simpl enrol uri hdr len strnlen s hdr est http req total len hdr len est http req total len est log warn `` csr attribut request header took maximum buffer d est http req total len hdr len function doe work csr attribut request flow paramet ctx est context ssl ssl context est client send csrattr request est ctx ctx ssl ssl csrattr csrattr len http data hdr len read size write size csr attr buf null rv assum defeat csrattr null csrattr len build http request alloc buffer header data termin charact build header data termin http data malloc est http req total len http data null est log err `` unabl alloc memori http data est err malloc hdr len est client build csr header ctx http data hdr len est log err `` csr attribut http header built correct free http data est err http build header termin http header snprintf http data hdr len est http req total len hdr len `` \\r\\n hdr len data sent ahead termin http request snprintf http data hdr len est http req total len hdr len `` \\r\\n hdr len send request server wait respons ctx http status write size ssl write ssl http data hdr len write size est log err `` tls write error ossl dump ssl error rv est err ssl write est log info `` tls wrote d byte attempt d bytes\\n write size hdr len tri respons server rv est io respons ctx ssl est op csrattr csr attr buf read size rv est err csr attr buf null csrattr csr attr buf csrattr len read size est err auth fail est log err `` est request fail d s rv est err num str rv csr attr buf free csr attr buf free http data rv function use build http header simpl enrol flow paramet ctx est context hdr pointer buffer hold header pkcs len length buffer point hdr est client build enrol header est ctx ctx hdr pkcs len hdr len snprintf hdr est http req total len `` post s s s s http \\r\\n `` user agent s\\r\\n `` connect close\\r\\n `` host s d\\r\\n `` accept \\r\\n `` content type applic pkcs\\r\\n `` content length d\\r\\n est path prefix ctx uri path segment `` ctx uri path segment ctx uri path segment est simpl enrol est http hdr est client ctx est server ctx est port num pkcs len est client add auth hdr ctx hdr est simpl enrol uri hdr len strnlen s hdr est http req total len hdr len est http req total len est log warn `` client enrol request header took maximum buffer d est http req total len hdr len function use build http header simpl enrol flow paramet ctx est context hdr pointer buffer hold header pkcs len length buffer point hdr est client build reenrol header est ctx ctx hdr pkcs len hdr len snprintf hdr est http req total len `` post s s s s http \\r\\n `` user agent s\\r\\n `` connect close\\r\\n `` host s d\\r\\n `` accept \\r\\n `` content type applic pkcs\\r\\n `` content length d\\r\\n est path prefix ctx uri path segment `` ctx uri path segment ctx uri path segment est simpl reenrol est http hdr est client ctx est server ctx est port num pkcs len est client add auth hdr ctx hdr est simpl enrol uri hdr len strnlen s hdr est http req total len hdr len est http req total len est log warn `` client reenrol request header took maximum buffer d est http req total len hdr len function send http request simpl enrol csr pkcs built point function simpli creat http header bodi put wire wait respons server copi respons buffer provid caller paramet ctx est context ssl ssl context bptr pointer contain pkcs csr pkcs pointer receiv pkcs respons pkcs len length pkcs respons reenrol set reenrol instead enrol est client send enrol request est ctx ctx ssl ssl buf mem bptr pkcs pkcs len reenrol http data hdr len write size enrol buf null enrol buf len rv assum enrol fail set length zero defens pkcs len build http request alloc buffer header data termin charact build header data termin http data malloc est http req total len http data null est log err `` unabl alloc memori http data est err malloc reenrol perform simpleenrol hdr len est client build enrol header ctx http data bptr length perform simplereenrol hdr len est client build reenrol header ctx http data bptr length hdr len est log err `` enrol http header built correct free http data est err http build header termin http header snprintf http data hdr len est http req total len hdr len `` \\r\\n hdr len build http bodi contain pkcs request memcpi s http data hdr len est http req data max bptr data rsize t bptr length hdr len bptr length termin http request snprintf http data hdr len est http req total len hdr len \\r\\n hdr len send request server wait respons ctx http status write size ssl write ssl http data hdr len write size est log err `` tls write error ossl dump ssl error rv est err ssl write est log info `` tls wrote d byte attempt d bytes\\n write size hdr len tri respons server rv est io respons ctx ssl est op simpl enrol enrol buf enrol buf len rv est err enrol buf len est log err `` enrol buf zero byte length rv est err zero length buf memcpi s pkcs est max client cert len enrol buf enrol buf len pkcs len enrol buf len est err auth fail est log warn `` http auth failur est log err `` est request fail d s rv est err num str rv free enrol buf openssl cleans http data strnlen s http data est http req total len free http data http data null rv function doe saniti check x prior attempt convert x csr reenrol oper return est error code est error est client check x x cert make sure cert cert signatur est log err `` certif provid doe contain signatur `` est err bad x make sure signatur length invalid cert signatur length est log err `` certif provid contain invalid signatur length `` est err bad x est err function use clear challeng password attribut x csr use http authent use enrol process po p valu chang client send second http request contain http author valu csr reus initi secondari request need clear po p valu csr submit secondari request est client clear csr pop x req csr pos x attribut attr challeng password po p csr happen defens pos look po p valu csr pos x req attr nid csr nid pkcs challeng password pos delet attr x req delet attr csr pos attr doc open ssl use x req delet attr go assum need free attribut appear good exampl use api x attribut free attr function doe work convert x req base encod der format specifi est rfc convert proper format routin forward request server check respons save cert local context retriev later applic layer est error est client enrol req est ctx ctx ssl ssl x req req pkcs len reenrol est error rv est err bio pout null b buf mem bptr null recv buf new cert buf new cert buf len grab pkcs pem encod data b bio new bio f base b est log err `` bio new fail ossl dump ssl error est err malloc pout bio new bio s mem pout est log err `` bio new fail ossl dump ssl error est err malloc pout bio push b pout encod use der asn set modifi flag x req open ssl keep cach copi der encod data case set flag tell open ssl run asn encod use cach copi req req info enc modifi id x req bio pout req bio flush pout bio mem ptr pout bptr buffer place entir respons server recv buf malloc est ca max recv buf null est log err `` fail alloc buffer server respons est err malloc new cert buf recv buf new cert buf len send pkcs http request est server rv est client send enrol request ctx ssl bptr new cert buf new cert buf len reenrol rv est err make sure got success code actual receiv new cert buf len est log err `` buffer contain newli enrol client certif zero byte length rv est err zero length buf resiz buffer hold retriev client certif link ctx rid http hdr extra space ctx enrol client cert null free ctx enrol client cert ctx enrol client cert malloc new cert buf len ctx enrol client cert null est log err `` unabl alloc newli enrol client certif buffer rv est err malloc ctx enrol client cert  new cert buf len  \\ memcpi s ctx enrol client cert new cert buf len new cert buf new cert buf len ctx enrol client cert len new cert buf len pass length newli enrol cert pkcs len ctx enrol client cert len est log info `` newli enrol client certif s ctx enrol client cert est log info `` length d ctx enrol client cert len est err auth fail est log info `` http author fail request auth mode d ctx auth mode est log err `` est enrol fail error code d s rv est err num str rv recv buf free recv buf bio free pout rv est client enrol pkcs function implement simpl enrol flow sign csr provid send csr est server retriev pkcs respons paramet ctx est context ssl ssl context use est session csr pointer x req object contain pkcs csr pkcs len pointer integ length reciev pkcs respons place priv key pointer privat key use sign csr reenrol set reenrol instead enrol return est error est error est client enrol pkcs est ctx ctx ssl ssl x req csr pkcs len evp pkey priv key reenrol est error rv est err tls uid ossl rv make sure po p remov csr proceed est client clear csr pop csr po p valu tls session emb csr requir ctx csr pop requir ctx client forc pop est log info `` client includ challeng password csr tls uid est tls uid ssl tls uid ossl rv x req add attr nid csr nid pkcs challeng password mbstring asc tls uid free tls uid ossl rv est log err `` unabl set x challeng password attribut ossl dump ssl error est err x attr est log err `` unabl obtain tls uid est err auth fail tlsuid sign csr ossl rv est client x req sign csr priv key ctx sign digest ossl rv est log err `` unabl sign x cert request ossl dump ssl error est err x sign rv est client enrol req ctx ssl csr pkcs len reenrol rv est client enrol cn function implement simpl enrol flow use privat key generat csr pkcs request send request est server retriev pkcs respons user function simpli provid common valu place pkcs csr simplifi interfac csr attribut specifi param ctx est context param ssl ssl context use est session param cn pointer common place x request param pkcs len pointer integ length reciev pkcs respons place param pkey new client public key enrol est error est error est client enrol cn est ctx ctx ssl ssl cn pkcs len evp pkey pkey x req pkcs null est error rv est err tls uid ctx est err ctx attempt creat pkcs certif request tls uid need popul tls uid est tls uid ssl tls uid rv est generat pkcs ctx cn tls uid pkey pkcs free tls uid est log err `` unabl obtain tls uid rv est err auth fail tlsuid rv est err rv est client enrol req ctx ssl pkcs pkcs len pkcs x req free pkcs rv follow function taken c url content incorpor portion lib hostcheck c lib rawstr c portabl consist toupper rememb ebcdic use toupper behavior alter current local est client curl raw toupper b b c c d d e e f f g g h h j j k k l l m m n n o o p p q q r r s s t t u u v v w w x x y y z z follow function taken c url curl raw equal do `` raw insensit string meant local independ compar string know safe http daniel haxx se blog strcasecmp turkish explan function necessari function capabl compar z insensit non ascii est client curl raw equal second second est client curl raw toupper est client curl raw toupper second loop soon nt match second comparison possibl just make sure loop skip string reach zero success match est client curl raw toupper est client curl raw toupper second follow function taken c url curl raw equal do `` raw insensit string meant local independ compar string know safe http daniel haxx se blog strcasecmp turkish explan function necessari function capabl compar z insensit non ascii est client curl raw nequal second size t max second max est client curl raw toupper est client curl raw toupper second max second max equal far est client curl raw toupper est client curl raw toupper second follow function taken c url curl raw equal do `` raw insensit string meant local independ compar string know safe http daniel haxx se blog strcasecmp turkish explan function necessari function capabl compar z insensit non ascii est client hostmatch hostnam pattern pattern label end pattern wildcard hostnam label end wildcard enabl size t prefixlen suffixlen addr ignor sockaddr si pattern wildcard strchr pattern pattern wildcard null est client curl raw equal pattern hostnam host match host nomatch detect ip address hostnam fail match inet pton af inet hostnam ignor host nomatch inet pton af inet hostnam si sin addr host nomatch dot pattern avoid wide wildcard match wildcard enabl pattern label end strchr pattern pattern label end null strchr pattern label end null pattern wildcard pattern label end est client curl raw nequal pattern `` xn wildcard enabl wildcard enabl est client curl raw equal pattern hostnam host match host nomatch hostnam label end strchr hostnam hostnam label end null est client curl raw equal pattern label end hostnam label end host nomatch wildcard match charact left label hostnam larg left label pattern hostnam label end hostnam pattern label end pattern host nomatch prefixlen pattern wildcard pattern suffixlen pattern label end pattern wildcard est client curl raw nequal pattern hostnam prefixlen est client curl raw nequal pattern wildcard hostnam label end suffixlen suffixlen host match host nomatch follow function taken c url fqdn check server cert est client cert hostcheck match pattern hostnam saniti check input match pattern match pattern hostnam hostnam trival est client curl raw equal hostnam match pattern est client hostmatch hostnam match pattern host match function taken c url adapt est c url file lib ssluse c function verifyhost quot rfc section `` server ident subject alt extens type d nsname present use ident specif common field subject field certif use use common exist practic deprec certif author encourag use d nsname instead match perform use match rule specifi  rfc  ident given type present certif e g d nsname match set consid accept name contain wildcard charact consid match singl domain compon compon fragment e g com match foo com bar foo com f com match foo com bar com case uri specifi ip address hostnam paddress subject alt present certif exact match ip uri est error est client verifyhost hostnam x server cert match altern match mean match mean mismatch size t addrlen stack general altnam addr addr v addr addr v addr v addr v est error res est err rv errno t safec rc numalt j diff general check altptr size t altlen nulstr peer cn x asn string tmp attempt resolv host v address rv inet pton af inet hostnam addr v rv addr v addrlen addr tri hostnam resolv v address rv inet pton af inet hostnam addr v rv addr v addrlen addr `` list altern name altnam x ext di server cert nid subject alt null null altnam altern rfc claim nt depend numalt sk general num altnam est log info `` d subject altern name numalt loop altern match numalt match handl altern number check sk general valu altnam data length altptr asn string data check d ia altlen size t asn string length check d ia check type gen dns pattern comparison est log info `` check fqdn san s altptr open ssl man page explicit say `` general assum data return asn string data null termin doe contain embed null `` actual format data depend actual string type exampl iastr data ascii gisl research open ssl sourc `` check sourc patch termin iastr altlen strnlen s altptr est max servernam len nt true embed zero string match est client cert hostcheck altptr hostnam match match gen ipadd ip address comparison compar altern ip address data chunk size server ip address psb complianc use safe c librari memcmp s addr v safec rc memcmp s altptr altlen addr v altlen diff safec rc eok est log info `` memcmp s error x x o ipv address\\n safec rc addr v safec rc memcmp s altptr altlen addr v altlen diff safec rc eok est log info `` memcmp s error x x o ipv address\\n safec rc forc match diff addr v altlen addrlen diff match addr v altlen addrlen diff match match general name free altnam match altern match server hostnam est log info `` subject alt s matched\\n hostnam match altern field exist did nt match fail est log info `` subject alt doe match s\\n hostnam res est err fqdn mismatch look occurr common distinguish signific follow bug b nulstr peer cn nulstr x subject server cert j x index nid nid common j entri convert string use comparison do support bmpstring utf tmp x entri data x entri open ssl d earlier asn string utf fail input utf encod check copi raw string manual avoid problem code condit futur open ssl fix work brought alexi s l carvalho tmp asn string type tmp v asn utfstr j asn string length tmp j peer cn malloc j peer cn safec rc memcpi s peer cn j asn string data tmp j safec rc eok est log info `` memcpi s error x x o asn string\\n safec rc peer cn  j  \\ utf j asn string utf peer cn tmp peer cn strnlen s peer cn est max servernam len j termin zero end string match failur est log warn `` ssl illeg cert field res est err fqdn mismatch peer cn nulstr peer cn null convert peer cn utf utf current support releas libest curlcod rc curl convert utf data peer cn strlen peer cn curl convert utf call failf unsuccess rc free peer cn est err fqdn mismatch endif res est err error detect pass peer cn est log warn `` ssl unabl obtain common peer certif res est err fqdn mismatch est client cert hostcheck peer cn hostnam est log warn `` ssl fqdn hostnam mismatch server certif s doe match `` `` target host s peer cn hostnam res est err fqdn mismatch est log info `` common s match peer cn peer cn free peer cn res routin check fqdn server certif configur server use establish tcp connect est server requir section est spec note fqdn check defin rfc look id kp cmc ra extend key usag extens server cert restrict allow fqdn mismatch id kp cmc ra present current way determin use explicit trust anchor allow addit flexibl est error est client check fqdn est ctx ctx ssl ssl x cert est error er cert ssl peer certif ssl cert er est client verifyhost ctx est server cert x free cert er cert ctx enabl srp est log info `` peer certif skip fqdn check srp enabl `` est err est log warn `` unabl perform fqdn check peer certif `` est err fqdn mismatch function open tcp socket establish tls session est server call est client init paramet ctx pointer est context client session ssl pointer ssl context structur ssl context creat reurn est err success est error est client connect est ctx ctx ssl ssl bio tcp ssl ctx s ctx est error rv est err ifndef win sock socket sock invalid socket endif rc oval ssl connect ret tcw err t tcw err tcw opt t tcw opt ctx est err ctx s ctx ctx ssl ctx establish connect proxi applic ctx use proxi tcw opt proxi proto ctx proxi proto tcw opt proxi host ctx proxi server tcw opt proxi port ctx proxi port ctx proxi usernam   ctx proxi password   ctx proxi auth est client proxi auth tcw opt proxi usernam ctx proxi usernam tcw opt proxi password ctx proxi password tcw opt proxi auth initi ctx proxi auth est client proxi auth basic tcw opt proxi auth est client proxi auth basic ctx proxi auth est client proxi auth ntlm tcw opt proxi auth est client proxi auth ntlm tcw opt proxi proto est client proxi tcw err tcw connect ctx tcw sock tcw opt ctx est server ctx est port num sock tcw err tcw err resolv est log err `` unabl lookup hostnam s `` ctx est server est err ip getaddr tcw err tcw ok est log err `` unabl connect est server s ctx est server est err ip connect enabl tcp aliv rc setsockopt sock sol socket keepal oval oval rc tcw close ctx tcw sock sock sock invalid est log err `` unabl connect est server address s ctx est server est err ip connect pass socket bio interfac open ssl use creat tls session tcp bio new socket sock bio noclos tcp null est log err `` error creat ip socket tcw close ctx tcw sock sock sock invalid ossl dump ssl error est err ip connect ssl ssl new s ctx est log err `` error creat tls context ossl dump ssl error bio free tcp tcw close ctx tcw sock sock sock invalid est err ssl new need set est ctx exdata ssl session context retriev session basi ssl set ex data ssl e ctx ssl exdata index ctx set est server ssl context ll sent server extens client hello ssl set tlsext host ssl ctx est server ssl set bio ssl tcp tcp ctx sess ssl set session ssl ctx sess ssl connect ret ssl connect ssl est log err `` error connect tls context d ssl error ssl ssl connect ret ossl dump ssl error tcw close ctx tcw sock sock sock invalid rv est err ssl connect ctx tcw sock connect ve establish tls session est server need verifi fqdn server cert match server use establish connect section est spec est err rv est client check fqdn ctx ssl host did match shut tunnel bail est client disconnect ctx ssl est log warn `` est server did match fqdn server certif `` rv est err fqdn mismatch rv function close tls session under socket paramet ssl pointer ssl context set connect est server est client disconnect est ctx ctx ssl ssl ssl session new sess ssl disconnect session id cach away use session resumpt ctx sess ctx sess ssl session ssl time disconnect session id chang did offici obtain cach away new sess ssl session ssl new sess ctx sess ctx sess ssl session ssl ssl shutdown ssl ssl free ssl ssl null ctx tcw sock connect tcw close ctx tcw sock ctx tcw sock connect function doe work cacert request flow paramet ctx est context ssl ssl context ca cert len pointer hold length return ca cert est client send cacert request est ctx ctx ssl ssl ca cert len http data hdr len write size rv ca cert buf null ca cert buf len build http request alloc buffer header data termin charact build header data termin http data malloc est http req total len http data null est log err `` unabl alloc memori http data est err malloc hdr len est client build cacert header ctx http data termin http header snprintf http data hdr len est http req total len hdr len \\r\\n hdr len data sent ahead termin http request snprintf http data hdr len est http req total len hdr len `` \\r\\n hdr len send request server wait respons ctx http status write size ssl write ssl http data hdr len write size est log err `` tls write error ossl dump ssl error rv est err ssl write est log info `` tls wrote d byte attempt d bytes\\n write size hdr len tri respons server rv est io respons ctx ssl est op cacert ca cert buf ca cert buf len rv est err make sure got success code actual receiv ca cert buf len est log err `` retriev ca cert buf zero byte length rv est err zero length buf ca cert buf len est ca max est log err `` retriev ca cert buf larger maximum allow rv est err buf exceed max len resiz buffer hold retriev ca cert link ctx rid http hdr extra space ctx retriev ca cert null free ctx retriev ca cert ctx retriev ca cert malloc ca cert buf len ctx retriev ca cert null est log err `` unabl alloc ca cert buffer rv est err malloc ctx retriev ca cert  ca cert buf len  \\ memcpi s ctx retriev ca cert ca cert buf len ca cert buf ca cert buf len ctx retriev ca cert len ca cert buf len verifi return ca cert chain rv verifi cacert resp ctx ctx retriev ca cert ctx retriev ca cert len rv est err est log err `` return cacert chain invalid free ctx retriev ca cert ctx retriev ca cert null ctx retriev ca cert len ca cert len ctx retriev ca cert len pass length retriev ca cert buffer ca cert len ctx retriev ca cert len est log info `` cacert buf s ctx retriev ca cert est log info `` cacert length d ctx retriev ca cert len est err auth fail est log err `` http auth failur est err ca enrol retri est log info `` http request fail retri resp est log err `` est request fail d s rv est err num str rv http data free http data ca cert buf free ca cert buf rv function doe work cacert request flow paramet ctx est context ssl ssl context ca cert len pointer hold length return ca cert est error est client set uid pw est ctx ctx uid pwd s userid password vice versa userid string `` null s password uid null pwd null est log err `` user id provid password est err invalid paramet uid null pwd null est log err `` password provid user id est err invalid paramet uid pwd set do basic digest authent uid null eok strncpi s ctx userid max uidpwd uid max uidpwd est log err `` invalid user id provid est err invalid paramet eok strncpi s ctx password max uidpwd pwd max uidpwd est log err `` invalid password provid est err invalid paramet est err brief est client enrol csr perform simpl enrol request est server use pkcs csr provid applic layer param ctx pointer est context param csr pointer pkcs csr data defin open ssl x req param pkcs len pointer integ hold length pkcs buffer param priv key pointer privat key use sign csr null est error est client enrol csr connect est server establish ssl tls connect est server configur previous est client set server send simpl enrol request applic layer provid pkcs csr enrol priv key argument given null csr need privat key csr contain requir includ public key privat key provid csr est librari sign csr enrol respons store est context length pass applic pkcs len paramt function applic alloc correct size buffer est client copi enrol cert retriev new client certif context unless csr indic null priv key applic provid pointer privat key use sign csr requir est librari event est server request proof possess valu includ csr est librari automat includ proof posess valu sign csr awar x req data pass function valid pass corrupt csr data result crash lib est util open ssl asn decod logic read x req data open ssl doe perform safeti check x req data pars applic read extern generat pem der encod csr data use est read x request helper function convert pem der csr valid x req pointer est error est client enrol csr est ctx ctx x req csr pkcs len evp pkey priv key est error rv ssl ssl null ctx est err ctx csr est err csr ctx est client initi est err client initi establish tls session est server rv est client connect ctx ssl rv est err err priv key rv est client enrol pkcs ctx ssl csr pkcs len priv key rv est client enrol req ctx ssl csr pkcs len est client disconnect ctx ssl rv est err auth fail ctx auth mode auth digest ctx auth mode auth basic ctx auth mode auth token https digest mode requir use md make sure fip mode use md ctx auth mode auth digest fip mode est log err `` http digest auth allow fip mode rv est err bad mode err tri time do digest auth est log info `` http auth fail tri digest basic paramet rv est client connect ctx ssl rv est err est log err `` connect fail second attempt basic digest paramet err priv key rv est client enrol pkcs ctx ssl csr pkcs len priv key rv est client enrol req ctx ssl csr pkcs len rv est err est log err `` enrol fail second attempt basic digest authent est client disconnect ctx ssl err ssl ssl shutdown ssl ssl free ssl rv brief est client enrol perform simpl enrol request est server param ctx pointer est context param cn pointer common valu use enrol request param pkcs len pointer integ hold length pkcs buffer param new public key pointer evp pkey structur hold client s key pair use simpl enrol request public key includ certif sign request csr sent ca server privat key use sign request est error est client enrol connect est server build simpl enrol request use common pass cn establish ssl tls connect est server configur previous est client set server send simpl enrol request respons store est context length pass applic pkcs len paramet function applic alloc correct size buffer est client copi enrol cert retriev new client certif context est error est client enrol est ctx ctx cn pkcs len evp pkey new public key est error rv ssl ssl null ctx est err ctx new public key est err key ctx est client initi est err client initi rv est client connect ctx ssl rv est err err rv est client enrol cn ctx ssl cn pkcs len new public key est client disconnect ctx ssl rv est err auth fail ctx auth mode auth digest ctx auth mode auth basic ctx auth mode auth token https digest mode requir use md make sure fip mode use md ctx auth mode auth digest fip mode est log err `` http digest auth allow fip mode rv est err bad mode err tri time do digest auth est log info `` http auth fail tri basic digest token paramet rv est client connect ctx ssl rv est err est log err `` connect fail second attempt basic digest token paramet err rv est client enrol cn ctx ssl cn pkcs len new public key rv est err est log err `` enrol fail second attempt basic digest authent attempt token mode second time server respond error attribut log ctx token error   \\ ctx token error desc   \\ est log err `` token auth mode fail server provid error inform \\n `` error s\\n error descript s ctx token error ctx token error desc ctx token error   \\ ctx token error desc   \\ est client disconnect ctx ssl ctx auth mode auth err ssl ssl shutdown ssl ssl free ssl rv brief est client provis cert perform sequenc est oper enrol new certif use trust messag flow param ctx pointer est context param cn pointer common valu use enrol request param pkcs len pointer integ hold length pkcs certif return ra ca param ca cert len pointer integ hold length buffer hold new trust ca certif param new public key pointer evp pkey structur hold client s key pair use simpl enrol request public key includ certif sign request csr sent ca server privat key use sign request est error est client provis cert connect est server retriev latest trust ca certifict server retriev csr attribut server send simpl enrol request server provis new certif ra ca conveni function equival invok follow function order est client cacert est client csrattr est client enrol function take common cn entiti identifi use csr addit x attribut extens requir est server enforc presenc csr attribut function use provis certif est client enrol csr function use addit x attribut includ enrol request provis respons store est context length pass applic pkcs len paramet function applic alloc correct size buffer est client copi enrol cert retriev new client certif context provis respons includ latest copi trust ca certif est server persist local applic futur use ca cert len argument contain length certic retriev invok est client copi cacert est error est client provis cert est ctx ctx cn pkcs len ca cert len evp pkey new public key est error rv new ta p new ta pem attr data null attr len new ta len ctx est err ctx make sure non null pointer length pkcs len ca cert len est err invalid paramet ctx est client initi est err client initi new public key est err key latest trust anchor cert server rv est client cacert ctx ca cert len rv est err rv new ta p malloc ca cert len new ta p null est log err `` unabl alloc ca cert buffer rv est err malloc rv rv est client copi cacert ctx new ta p rv est err free new ta p rv cert base der encod need convert pem new ta len est convert pb pem new ta p ca cert len new ta pem free new ta p new ta len est err pem read new trust anchor s pem encod let s load current est context futur est oper use new trust anchor ctx trust cert store null x store free ctx trust cert store rv est load trust cert ctx new ta pem new ta len free new ta pem rv est err rv ve reset trust store mark client context initi ctx est client initi need csr attribut allow lib est know challeng password need includ csr rv est client csrattr ctx attr data attr len rv est err est log err `` unabl csr attribut provis new certif rv final attempt enrol new certif use common provid applic rv est client enrol ctx cn pkcs len new public key rv brief est client reenrol perform enrol request est server use exist x certif param ctx pointer est context param cert pointer x certif defin open ssl x param pkcs len pointer integ hold length pkcs buffer param priv key pointer privat key use sign csr est error est client reenrol connect est server establish ssl tls connect est server configur previous est client set server send enrol request applic layer provid x certif enrol certif previous enrol ca applic need provid privat key associ public key x certif privat key requir sign csr generat x certif enrol respons store est context length pass applic pkcs len paramt function applic alloc correct size buffer est client copi enrol cert retriev new client certif context applic provid pointer privat key use sign csr requir est librari event est server request proof possess valu includ csr est librari automat includ proof posess valu sign csr awar public key subject x certif includ enrol request sent est server ca respons appli x extens issu renew certif est error est client reenrol est ctx ctx x cert pkcs len evp pkey priv key x req req est error rv ssl ssl null ossl rv ctx est err ctx cert est err cert priv key est err key ctx est client initi est err client initi check x given rv est client check x cert rv est err rv check privat key match public key cert x check privat key cert priv key est err client invalid key convert exist certif csr copi subject cert new csr pass null privat key paramet sign csr later req x x req cert null ctx sign digest req est log err `` x csr convers fail `` ossl dump ssl error est err csr copi x extens old certif csr ca retain behavior depend polici use open ssl test ca set copi extens set config file copyal retain extens csr issu new cert cert cert info cert cert info extens ossl rv x req add extens req cert cert info extens ossl rv est log warn `` fail copi x extens csr new certif contain extens present old certif `` establish tls session est server rv est client connect ctx ssl rv est err err send enrol request rv est client enrol pkcs ctx ssl req pkcs len priv key est client disconnect ctx ssl rv est err auth fail ctx auth mode auth digest ctx auth mode auth basic ctx auth mode auth token https digest mode requir use md make sure fip mode use md ctx auth mode auth digest fip mode est log err `` http digest auth allow fip mode rv est err bad mode err tri time do digest auth est log info `` http auth fail tri digest basic paramet rv est client connect ctx ssl rv est err est log err `` connect fail second attempt basic digest paramet err rv est client enrol pkcs ctx ssl req pkcs len priv key rv est err est log err `` reenrol fail second attempt basic digest authent attempt token mode second time server respond error attribut log ctx token error   \\ ctx token error desc   \\ est log err `` token auth mode fail server provid error inform \\n `` error s\\n error descript s ctx token error ctx token error desc ctx token error   \\ ctx token error desc   \\ est client disconnect ctx ssl err ssl ssl shutdown ssl ssl free ssl x req free req rv brief est client copi enrol cert pass client certif previous obtain est server est client enrol param ctx pointer est context param cn pointer common valu use enrol request param pkcs pointer pointer point buffer contain newli enrol client certif est error est client copi enrol cert copi previous obtain client certif est context applic s buffer client certif copi context remov context est error est client copi enrol cert est ctx ctx pkcs ctx est err ctx ctx est client initi est err client initi pkcs null est log err `` est client simpl enrol invalid paramet est err invalid paramet ctx enrol client cert null est log err `` client certif copi est err certif memzero s pkcs ctx enrol client cert len memcpi s pkcs ctx enrol client cert len ctx enrol client cert ctx enrol client cert len copi context hand free free ctx enrol client cert ctx enrol client cert null ctx enrol client cert len est err brief est client cacert perform cacert request est server param ctx pointer est context param ca cert len pointer integ hold length ca cert buffer est error est client cacert connect est server build ca cert request send ca cert request respons place buffer alloc maintain est client librari pointer buffer return call applic return ca cert base encod der format store null termin string buffer ca certif retriev est server et client librari reset retriev ca certif pass est client initi function explicit ta databas est error est client cacert est ctx ctx ca cert len est error rv est err ssl ssl null ctx est err ctx ctx est client initi est err client initi ca cert len null est log err `` est client cacert invalid paramet est err invalid paramet rv est client connect ctx ssl rv est err ssl ssl shutdown ssl ssl free ssl rv rv est client send cacert request ctx ssl ca cert len est client disconnect ctx ssl ssl ssl shutdown ssl ssl free ssl rv brief est client copi cacert copi previous retriev ca certif applic s buffer param ctx pointer current est context param ca cert pointer buffer retriev ca certif copi est error est client copi cacert copi recent retriev ca certif est server ca certif copi applic s buffer point ca cert remov est clietn context ca certif retriev applic est client librari reset reset perform ca certif retriev est client copi cacert pass est client initi function explicit ta databas est error est client copi cacert est ctx ctx ca cert ctx est err ctx ctx est client initi est err client initi ca cert null est log err `` est client cacert invalid paramet est err invalid paramet ctx retriev ca cert null est log err `` ca certif copi est err certif memzero s ca cert ctx retriev ca cert len memcpi s ca cert ctx retriev ca cert len ctx retriev ca cert ctx retriev ca cert len ca cert obtain client lib need reset ctx est client initi est err brief est client csrattr perform csr attribut request est server param ctx pointer est context client session param csr data pointer buffer hold return csr attribut param csr len pointer integ hold length csr attribut buffer est error est client csrattr connect est server send csr attribut request server save away return csr attribut data disconnect est server est error est client csrattr est ctx ctx csr data csr len rv new csr len pop requir ssl ssl null new csr data ctx est err ctx csr data est err invalid paramet csr len est err invalid paramet assum defeat csr data null csr len connect est server rv est client connect ctx ssl rv est err ssl ssl shutdown ssl ssl free ssl rv free current attribut cach ctx retriev csrattr free ctx retriev csrattr ctx retriev csrattr null ctx retriev csrattr len ctx retriev csrattr len ctx retriev csrattr null send http request est server rv est client send csrattr request ctx ssl new csr data new csr len est client disconnect ctx ssl rv est err est log err `` csr request fail error code d s rv est err num str rv new csr data free new csr data ssl ssl shutdown ssl ssl free ssl rv ssl ssl shutdown ssl ssl free ssl new csr data null est log info `` csr attribut null est err alloc new memori prior pars sure null termin ctx retriev csrattr malloc new csr len ctx retriev csrattr free new csr data est err malloc ctx retriev csrattr len new csr len memcpi s ctx retriev csrattr new csr len new csr data new csr len ctx retriev csrattr  new csr len  est log info `` csr attribut d s ctx retriev csrattr len ctx retriev csrattr free new csr data make sure data valid rv est asn pars attribut ctx retriev csrattr ctx retriev csrattr len pop requir rv est err free ctx retriev csrattr ctx retriev csrattr null ctx retriev csrattr len csr data ctx retriev csrattr csr len ctx retriev csrattr len ctx csr pop requir pop requir rv brief est client enabl srp use applic enabl tls srp transport use place tradit tls tls srp allow secur transport x certif avail trust anchor avail param ctx est context obtain est client init param strength specifi srp strength use param uid buffer contain user id use srp user param pwd buffer contain passowrd use srp password function allow applic enabl tls srp cipher suit form tls use est client doe x certif identifi est server use est client trust anchor avail authent est server ident est server support tls srp use api function invok est client init prior issu est command string paramet null termin string est error est error est client enabl srp est ctx ctx strength uid pwd x store store rv ctx null est log err `` null context pass est err ctx ctx ssl ctx null est log err `` ssl context initi est err ssl ctx strength est srp strength min est log err `` srp strength greater d est srp strength min est err srp strength low uid null est log err `` srp user id provid est err invalid paramet pwd null est log err `` srp password provid est err invalid paramet ctx enabl srp enabl just srp cipher suit srp enabl s use exclus check trust anchor configur enabl dss rsa auth cipher suit store ssl ctx cert store ctx ssl ctx store store obj sk x object num store obj est log info `` enabl ssl srp cipher suit rsa dss\\n rv ssl ctx set cipher list ctx ssl ctx est cipher list srp auth est log info `` enabl ssl srp cipher suit w o rsa dss\\n rv ssl ctx set cipher list ctx ssl ctx est cipher list srp rv est log err `` fail set ssl srp cipher suites\\n ossl dump ssl error est err ssl cipher list set srp user password ssl ctx set srp usernam ctx ssl ctx uid est log err `` unabl set srp username\\n ossl dump ssl error est err unknown ssl ctx set srp password ctx ssl ctx pwd est log err `` unabl set srp password\\n ossl dump ssl error est err unknown ssl ctx set srp strength ctx ssl ctx strength est log info `` tls srp enabl est err brief est client set auth use applic set authent paramet use param ctx est context obtain est client init param uid buffer contain user id use basic digest base authent param pwd buffer contain passowrd use basic digest base authent param client cert raw buffer contain client applic certif param pkey raw privat key use client cert param pkey len length buffer hold privat key function allow applic provid inform requir authent est client est server accept request ca cert user id provid password provid applic pass privat key pkey raw pkey len use sign request server basic digest base authent perform tls session request privat key pass contain privat key match public key contain client cert paramet string paramet null termin string est error error null est error est client set auth est ctx ctx uid pwd x client cert evp pkey privat key est error rv est err ctx null est log err `` null context pass est err ctx rv est client set uid pw ctx uid pwd rv est err rv ctx auth mode auth cach away client cert associ privat key load ssl context ll use ctx client key privat key ctx client cert client cert load client cert s avail ctx client cert ctx client key est client set cert key ctx ssl ctx ctx client cert ctx client key est log err `` unabl load local certif privat key est err client invalid key est log warn `` use client certif tls session http basic digest auth use `` est err brief est client set auth cred cb use applic callback function param ctx est context obtain est client init param auth credenti cb function pointer applic layer callback regist callback function use est client librari obtain authent credenti applic provid authent credenti initi avail userid password use http basic authent process request est client librari applic callback event doe authent credenti request est server callback function definit match follow function prototyp auth credenti cb est http auth hdr auth credenti auth credenti pointer est http auth hdr structur structur provid est librari callback function fill specif credenti request credenti valu pass format sent server est client librari perform reformat credenti ownership memori hold credenti valu transfer applic layer est librari applic layer return valu est librari allow est librari free memori soon use valu valu callback follow valu est http auth cred success callback abl provid request credenti est http auth cred avail callback provid request credenti auth credenti cb paramet set null reset callback function string paramet null termin string est error est err success est err ctx est error est client set auth cred cb est ctx ctx auth credenti cb callback ctx null est log err `` null context pass est err ctx ctx auth credenti cb callback est err brief est client enabl basic auth hint use applic reduc overhead tcp tls layer client know est server use http basic authent param ctx pointer est context client session normal lib est send anonym http request do initi request est server function allow applic improv perform send http basic auth header initi request sent est server elimin need server send http authent challen respons elimin round trip est client server function call immedi invok est client set auth precaut taken applic ensur hint enabl known est server configur http basic authent est server configur http digest authent enabl hint caus est transact fail est error est err success est error est client enabl basic auth hint est ctx ctx ctx null est log err `` null context pass est err ctx ctx auth mode auth basic est err brief est client init use applic creat context est librari context use invok function client api param ca chain requir buffer contain ca certif raw byte data use authent est server param ca chain len length ca chain buffer param cert format defin format certif pass instanti est client librari current valu accept est cert format pem param cert verifi cb pointer function est client applic call receiv server ident certif fail verif ssl code function take input paramet pointer x structur contain server certif integ valu set open ssl defin error certif callback function return server ident certif reject valu approv function allow applic initi est client context applic provid local ca certif ca chain ca chain len use client oper certif provid format specifi cert format paramet current pem encod certif support length paramet certif ca chain len use der format certif pass ca certif contain crl entri use authent certif receiv server est ctx error null est ctx est client init ca chain ca chain len est cert format cert format cert verifi cb x est ctx ctx len rv ifdef win result initi winsock result wsastartup makeword wsa data result est log err `` wsastartup fail d\\n result endif cert format est cert format pem est log err `` pem encod certif support `` null ca chain pass check length valu pass match calcul length buffer verifi length valu correct buffer proper null termin ca chain len strnlen s ca chain est ca max len ca chain len est log err `` length ca chain doe nt match pass ca chain len null ctx malloc est ctx ctx est log err `` unabl alloc memori est context null memzero s ctx est ctx ctx est mode est client load local ca certif memori retain futur use use cacert request est load trust cert ctx ca chain ca chain len est log err `` fail load trust certif store est destroy ctx null rv est client init ssl ctx ctx rv est err est log err `` fail initi ssl context certifici privat key pass est destroy ctx null save away client s callback function allow manual verif server s ident certif ctx manual cert verifi cb cert verifi cb set valu socket read timeout ctx read timeout est ssl read timeout def use sha hash algorithm sign csr chang applic use est client set sign digest function ctx sign digest evp sha ctx retri delay ctx retri date ctx est client initi ctx brief est client init use applic creat context est librari context use invok function client api param ca chain requir buffer contain ca certif raw byte data use authent est server param ca chain len length ca chain buffer param cert format defin format certif pass instanti est client librari current valu accept est cert format pem param cert verifi cb pointer function est client applic call receiv server ident certif fail verif ssl code function take input paramet pointer x structur contain server certif integ valu set open ssl defin error certif callback function return server ident certif reject valu approv function allow applic initi est client context applic provid local ca certif ca chain ca chain len use client oper certif provid format specifi cert format paramet current pem encod certif support length paramet certif ca chain len use der format certif pass ca certif contain crl entri use authent certif receiv server est ctx error null est error est client pars path seg path seg uri parser state state uri uri pars uri uripars rc uri path segment cur seg null cur seg str null est oper oper can uri  est uri max len  build can uri pass uripars librari caus incom path segment correct spot uri get valid main issu possibl use path segment theme delimit memzero s can uri est uri max len strcpi s can uri est uri max len `` known est strcat s can uri est uri max len path seg state uri pars uri uripars rc uri pars uri state can uri uripars rc uri success uri free uri member state uri est err http invalid path segment cur seg pars uri path head cur seg null est log err `` valid path segment suppli string uri free uri member state uri est err http invalid path segment cur seg cur seg cur seg str cur seg text oper est pars oper cur seg str look oper path come cacert csrattr simpleenrol simplereenrol oper occur path segment string problem oper est op max est log err `` path segment string contain oper valu path segment pass s\\n cur seg str uri free uri member state uri est err http invalid path segment look multipl segment cur seg null cur seg text \\ est log err `` path segment string contain multipl path segment path segment uri free uri member state uri est err http invalid path segment uri free uri member state uri est err brief est client set server call applic layer specifi address port est server call est client init prior issu est command param ctx pointer est context client session param server est server connect ascii string repres server limit charact param port tcp port est server connect param path segment string contain path segment ad uri use set null est error est err success est err ctx null valu pass est context est err invalid server null valu pass est server server string est err client initi call est client init est err invalid port num invalid port number input zero greater est client set server error check input paramet store hostnam port number est context est error est client set server est ctx ctx server port path segment ctx est err ctx ctx est client initi est err client initi server null est err invalid server port port est err invalid port num eok strncpi s ctx est server est max servernam len server est max servernam len est err invalid server ctx est port num port ifdef uripars path segment len est error rc path segment null path segment \\ est err http invalid path segment make sure s path segment len strnlen s path segment est max path segment len path segment len est max path segment len est err http invalid path segment valid incom path segment string rc est client pars path seg path segment rc est err est log err `` path segment fail valid `` rc valid store away context rc est store path segment ctx path segment path segment len rc est err est log err `` fail store uri path segment `` rc uripars support support path segment pass path segment est log err `` use path segment support build lib est `` est err http path segment support endif est err brief est client set proxi call applic layer specifi proxi est server call est client init prior issu est command param ctx pointer est context client session param proxi proto proxi protocol param proxi server proxi server connect ascii string repres server limit charact est max servernam len param port tcp port proxi server connect param proxi auth proxi authent method param usernam usernam use authent proxi param password password use authent proxi est error est err success est err ctx null valu pass est context est err invalid server null valu pass est server server string est err invalid port num port num proxi server invalid est err client initi call est client init est err invalid paramet null valu pass usernam password usernam password est err client proxi mode support client proxi mode support built libcurl support est err invalid client proxi protocol invalid proxi protocol specifi est client set proxi error check input paramet store proxi inform est context note http proxi tunnel support lib est server mode configur lib est client mode communic lib est server mode est client proxi http notunnel specifi proxi protocol est error est client set proxi est ctx ctx est client proxi proto proxi proto proxi server proxi port proxi auth usernam password ifdef libcurl ctx est err ctx ctx est client initi est err client initi proxi server null proxi server   \\ est err invalid server est max servernam len strnlen s proxi server est max servernam len est err invalid server ctx proxi server   \\ eok strncpi s ctx proxi server ctx proxi server proxi server ctx proxi server est err invalid server proxi port proxi port est err invalid port num ctx proxi port proxi port proxi proto est client proxi http notunnel proxi proto est client proxi sock hostnam est err invalid client proxi protocol ctx proxi proto proxi proto proxi auth est client proxi auth proxi auth est client proxi auth basicest client proxi auth ntlm est err invalid client proxi auth ctx proxi auth proxi auth usernam password proxi auth est client proxi auth max uidpwd strnlen s usernam max uidpwd est err invalid paramet usernam   \\ est err invalid paramet ctx proxi usernam   \\ eok strncpi s ctx proxi usernam ctx proxi usernam usernam ctx proxi usernam est err invalid paramet max uidpwd strnlen s password max uidpwd est err invalid paramet password   \\ est err invalid paramet ctx proxi password   \\ eok strncpi s ctx proxi password ctx proxi password password ctx proxi password est err invalid paramet ctx proxi auth proxi auth ctx use proxi est err est librari built support libcurl client proxi mode support est log err `` client proxi mode requir libest built libcurl `` est err client proxi mode support endif brief est client set sign digest call applic layer specifi hash algorithm use sign pkcs csr enrol oper call est client init prior issu est command param ctx pointer est context client session param nid nid valu defin open ssl header file obj mac h desir digest use sign est error est err success est err ctx null valu pass est context est err invalid digest unsupport nid provid lib est support sha sha sha sha sha digest sha digest use sign s need invok function unless digest desir support nid valu nid sha nid sha nid sha nid sha nid sha est error est client set sign digest est ctx ctx nid ctx est err ctx nid nid sha ctx sign digest evp sha nid sha ctx sign digest evp sha nid sha ctx sign digest evp sha nid sha ctx sign digest evp sha nid sha ctx sign digest evp sha est err invalid digest est err brief est client copi retri copi retri valu store client context param ctx pointer current est context param retri delay pointer integ retri delay sec valu copi server sent retri delay second format pass did valu zero param retri time pointer time t retri time date valu copi server sent retri time date string format string convert time t valu pass paramet valu set server sent time date string respons valu set zero est error respons receiv est server header check server includ retri header indic request current process retri http header includ receiv respons server delay valu save context est error code given applic request indic client retri request later time valu specifi server basic format string version integ valu repres number second client wait retri request string contain date time client retri request date time string format specifi rfc second delay valu sent convert integ save est context date time string valu sent convert time t valu save est context applic est client copi retri obtain time wait retri request est client copi retri copi current retri valu client context return applic valu set non zero valu note process retri valu time date format current support est client retri delay valu second est error est client copi retri est ctx ctx retri delay time t retri time ctx est err ctx ctx est client initi est err client initi retri delay ctx retri delay ctx retri delay retri time ctx retri date ctx retri date est err brief est client forc pop use applic enabl proof possess generat est client prove est client sent csr server proxi possess privat key use sign csr bind tls session id csr note csr attribut configur server po p check need function enabl po p po p enabl automat scenario csr attribut request server proxi param ctx pointer est context function call time est error est error est client forc pop est ctx ctx ctx est log err `` null context est err ctx ctx client forc pop est err brief est client unforc pop use applic disabl proof possess generat est client documen est client forc pop inform proof possess check param ctx pointer est context function call time est error est error est client unforc pop est ctx ctx ctx est log err `` null context est err ctx ctx client forc pop est err brief est client set read timeout use applic set timeout valu read oper est client send request est server attempt read respons server timeout valu limit time client wait respons param ctx pointer est context param timeout integ valu repres read timeout second minimum valu est ssl read timeout min maximum valu est ssl read timeout max est error est error est client set read timeout est ctx ctx timeout ctx est log err `` null context est err ctx timeout est ssl read timeout min timeout est ssl read timeout max est log err `` invalid read timeout valu pass d `` timeout est err invalid paramet ctx read timeout timeout est err brief est client http status use applic http status code return est server recent oper param ctx pointer est context call est oper enrol oper function recent http status code receiv est server normal status return est server indic success oper oper fail reason http status code use understand reason failur instanc est server http status est client author rfc descript various http status code valu repres http status code null null est context provid est client http status est ctx ctx ctx ctx http status
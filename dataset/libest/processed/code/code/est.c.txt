 est log func va list null logger routin just dump log data stderr applic overrid call est init logger pass function pointer function implement prototyp est logger stderr format va list l ifndef win flockfil stderr endif vfprintf stderr format l fflush stderr ifndef win funlockfil stderr endif logger routin just dump log data stderr applic overrid call est init logger pass function pointer function implement prototyp est log msg format va list argument pull argument stack invok logger function va start argument format est log func null est log func format argument est logger stderr format argument va end argument global function call log est log est log level lvl format va list argument check user interest log messag lvl est desir log lvl pull argument stack invok logger function va start argument format est log func null est log func format argument est logger stderr format argument va end argument global function call log print stack trace stack   frame symbol info symbol handl process process current process sym initi process null true frame captur stack trace stack null symbol symbol info calloc symbol info symbol max len symbol size symbol info frame sym addr process dword stack   symbol est log msg `` \\n  x x  s frame symbol address symbol free symbol global function call log est log backtrac ifndef disabl backtrac ifdef win spit backtrac enabl global est backtrac enabl print stack trace callstack   strs frame spit backtrac enabl global est backtrac enabl frame backtrac callstack strs backtrac symbol callstack frame frame est log msg `` \\n s strs   fprintf stderr `` s\\n strs   est log msg `` \\n\\n free strs endif win endif disabl backtrac brief est version allow applic retriev lib est version string return array contain version string valu librari est version est ver string brief est api level allow applic retriev lib est api level numer valu indic api level librari new version lib est releas api chang valu increment applic use determin capabl lib est librari attempt est api level est api level use log lib est version inform log messag log compil time run time open ssl version est log version est log info `` s api level d est version est api level ifdef sourc revis est log info `` sourc repositori revis d sourc revis endif est log info `` compil s openssl version text est log info `` link s ssleay version ssleay version brief est init logger allow applic overrid log handler est log messag param lvl set desir log level est log level param loggerfunc set callback function handl log function allow applic use est provid function log est messag est provid handler send messag stderr applic desir send messag syslog log facil applic provid function pointer use method intercept handl est log messag set global librari impact context est error est error est init logger est log level lvl loggerfunc va list initi logger loggerfunc est log func loggerfunc instal logger est log func est logger stderr set desir log level est desir log lvl lvl est err brief est enabl backtrac allow applic toggl stack trace display warn error log messag come lib est param enabl set zero disabl stack trace non zero enabl stack trace log facil function allow applic enabl stack trace use troubleshoot lib est librari stack trace disabl function non zero argument enabl stack trace warn error log messag set global librari impact context est enabl backtrac enabl est backtrac enabl enabl brief est read x request helper function read convert open ssl x req data pem der encod param csr contain pem der encod x csr param csr len length csr der encod data contain zero requir length provid applic layer param csr format paramet specifi encod method csr provid set est cert format pem est cert format der function convert pem der encod open ssl x req structur function null pem der data corrupt unabl pars open ssl librari function alloc memori x req data free memori applic s longer need call x req free x req x req est read x request csr csr len est cert format csr format x req req null bio err csr est log err `` csr null null csr len est raw csr len max est log err `` csr length greater maximum allow d est raw csr len max null csr format est cert format pem csr format est cert format der est log err `` pem der encod format support `` null bio new mem buf csr csr len null est log err `` unabl open csr memori buffer null csr format est cert format pem req pem read bio x req null null null est cert format der req di x req bio null est log err `` invalid csr format specifi `` check error pars input data req est log err `` error occur open ssl librari read csr data `` err err error est log err `` open ssl error string s err error string err null bio free req brief est load key helper function read convert open ssl evp pkey data pem der encod param key contain pem der encod key pair param key len length key der encod data contain zero requir length provid applic layer param key format paramet specifi encod method key provid set est format pem est format der function convert pem der encod open ssl evp pkey structur function null pem der data corrupt unabl pars open ssl librari function alloc memori evp pkey data free memori applic s longer need call evp pkey free evp pkey evp pkey est load key key key len format bio null evp pkey pkey null key null est log err `` key data provid null bio new mem buf key key len null est log err `` unabl open provid key buffer null format est format pem pkey pem read bio privat key null null null est format der pkey di privat key bio null est log err `` invalid key format bio free null bio free pkey convert pem pkcs encod cert option appli base encod output use creat cach cacert respons return bio contain pkcs encod cert respons option base encod pass non zero valu base_ argument caller function invok bio free valu avoid memori leak note bio free suffici bio est cert pkcs bio base_ stack x cert stack null pkcs ps null pkcs p null bio null bio b buflen creat pkcs object p pkcs new null est log err `` pkcs new fail cleanup creat pkcs object ps pkcs new null est log err `` pkcs new fail cleanup set version asn integ set ps version est log err `` asn integ set fail cleanup creat stack x cert cert stack sk x new null null est log err `` stack malloc fail cleanup popul cert stack est add cert bio cert stack est log err `` unabl load certif ossl dump ssl error cleanup creat bio receiv output bio new bio s mem est log err `` bio new fail cleanup add base encod need base_ b bio new bio f base b null est log err `` bio new fail attempt creat base bio ossl dump ssl error cleanup bio push b p type obj nidobj nid pkcs p d sign ps ps content type obj nidobj nid pkcs data ps cert cert stack convert pem pkcs buflen id pkcs bio p buflen est log err `` pem write bio pkcs fail ossl dump ssl error bio free null cleanup bio flush cleanup need cleanup p free ps cert stack alloc link p p pkcs free p take raw array conta ca certif read data load certif context pkcs cert store est context use respond cacert request requir pkcs encod function load x store context use verifi peer est error est load ca cert est ctx ctx raw size bio cacert null bio retval server proxi mode load cacert respons ctx est mode est client est err bad mode bio new mem buf raw size null est log err `` unabl open raw cert buffer est err load cacert convert ca cert pkcs encod array use est server respond cacert request cacert est cert pkcs cacert est log err `` est cert pkcs fail bio free est err load cacert ctx ca cert len bio mem data cacert retval ctx ca cert len est log err `` fail copi pkcs data bio free cacert bio free est err load cacert ctx ca cert malloc ctx ca cert len ctx ca cert est log err `` malloc fail bio free cacert bio free est err load cacert memcpi s ctx ca cert ctx ca cert len retval ctx ca cert len bio free cacert bio free est err take array contain pem encod ca certif implicit explict cert decod load trust cert store member est context cert store use tls stack peer verif tls layer note includ defens code check null argument function public api check perform est error est load trust cert est ctx ctx cert cert len est error rv creat combin cert store context contain implicit explicit cert ctx trust cert store x store new ctx trust cert store null est log err `` unabl alloc combin cert store est err load trust cert x store set verifi cb ctx trust cert store ossl verifi cb rv ossl init cert store ctx trust cert store cert cert len rv est err est log err `` unabl popul combin cert store rv est err brief est set ex data set applic specif data est context param ctx pointer est context param ex data pointer applic specif data pass est callback est error function use link applic specif data est ctx structur use applic bind applic specif data est oper lib est doe use applic specif data ex data pointer pass applic lib est invok enrol enrol csr attribut http auth callback lib est free memori referenc ex data paramet est destroy invok applic respons releas applic specif data est error est set ex data est ctx ctx ex data ctx est err ctx ctx ex data est log warn `` ex data set possibl memori leak ctx ex data ex data est err brief est ex data retriev applic specif data est context param ctx pointer est context function use attain refer applic specif data est ctx structur data set invok est set ex data earlier null est ex data est ctx ctx ctx null ctx ex data brief est destroy free est context param ctx pointer est context est error function use releas memori alloc est ctx call perform est oper use context est error est destroy est ctx ctx ctx est err ctx ctx trust cert store null x store free ctx trust cert store ctx ca cert free ctx ca cert ctx retriev ca cert free ctx retriev ca cert ctx retriev csrattr free ctx retriev csrattr ctx server csrattr free ctx server csrattr ctx enrol client cert free ctx enrol client cert ctx ca chain raw free ctx ca chain raw ctx uri path segment free ctx uri path segment ctx dh tmp dh free ctx dh tmp free ssl context act client oper server s expect web server free context ctx ssl ctx ctx est mode est client ctx est mode est proxi ssl session cach mean ssl session call need explict freed ref count decrememnt ctx sess ssl session free ctx sess ssl ctx free ctx ssl ctx ctx est mode est proxi proxi cleanup ctx final free est context free ctx est err routin use determin bio flag base nl option need use use open ssl base decod take string input check contain newlin charact return open ssl use bio flag base nl option return est base contain nl src len len base byte nt problem open ssl minimum line length base encod start look newlin th posit len src   x routin use decod base encod data pass base encod data pointer buffer receiv decod data length decod data return valu zero negat error occur dst size paramet maximum allow size decod data est base decod src dst dst size bio b bin len max decod base output smaller ratio determin max size input base size given output buffer make sure actual input buffer big max dst size length base encod data make sure s big len strnlen s src max len max est log err `` sourc buffer base decod loo larg destin buffer `` `` sourc buf len d max input len d max dest len d len max dst size b bio new bio f base b null est log err `` bio new fail attempt creat base bio ossl dump ssl error bin bio new mem buf src len bin null est log err `` bio new fail attempt creat mem bio ossl dump ssl error est base contain nl src len enabl newlin option input data doe nt contain newlin charact s bad open ssl doe nt implicit bio set flag b bio flag base nl bin bio push b bin len bio read bin dst dst size len est log warn `` bio read fail decod base data d len make sure respons null termin dst  len  bio free bin len routin use encod base data pass unencod data length sourc buffer pointer buffer receiv encod data length encod data return valu zero error occur max dest len paramet maximum allow size encod data est base encod src actual src len dst max dst len bio b bio max src len actual dst len write cnt buf mem bptr null encod base output larger ratio determin max size input base size given output buffer make sure actual input buffer big max src len max dst len actual src len max src len est log err `` sourc buffer base encod loo larg destin buffer `` `` max sourc len d actual sourc len d max src len actual src len b bio new bio f base b null est log err `` bio new fail attempt creat base bio ossl dump ssl error bio new bio s mem null est log err `` bio new fail attempt creat mem base bio ossl dump ssl error bio free b bio push b nt insert new line bio set flag bio flag base nl write sourc buffer bio pointer result memori buffer obtain result write cnt bio write src actual src len bio flush bio mem ptr bptr write cnt est log warn `` bio write fail encod base data d write cnt copi result base encod string make sure null termin length memcpi s dst max dst len bptr data bptr length dst  bptr length  \\ actual dst len bptr length bio free b actual dst len routin use encod base data pass unencod data length sourc buffer pointer buffer receiv encod data length encod data return valu zero error occur max dest len paramet maximum allow size encod data est tls uid ssl ssl client finish  max finish  bio bio null b null buf mem bptr null len rv null rfc state finish messag use deriv tls uniqu id session resumpt use server send finish messag normal client send finish messag client ssl session reus ssl client ssl session reus ssl len ssl finish ssl finish max finish len ssl peer finish ssl finish max finish b bio new bio f base b null est log err `` bio new fail attempt creat base bio ossl dump ssl error rv bio bio new bio s mem bio null est log err `` bio new fail attempt creat mem base bio ossl dump ssl error rv bio flush bio bio bio push b bio bio write bio finish len bio flush bio bio mem ptr bio bptr awar open ssl add newlin charact end base encod data bptr length est tls uid len est log warn `` tls uid length mismatch d d bptr length est tls uid len rv malloc est tls uid len rv null est log err `` fail alloc buffer rv memcpi s rv est tls uid len bptr data est tls uid len rv  est tls uid len  \\ est log info `` tls uid bio free bio rv util function convert hex valu string use http digest authent logic est hex str dst src len hex `` abcdef len src dst hex  src    dst hex  src   xf  dst \\ brief est enabl crl use applic enabl check certif revoc list valid client tls peer certif tls handshak enabl ca chain paramet provid est server init est client init contain trust certif crl entri crl entri appen end param ctx pointer est context crl check disabl function call invok est server init est client init prior perform est oper disabl version method est error est error est enabl crl est ctx ctx ctx est log err `` null context est err ctx ctx enabl crl est err est asn saniti test perform saniti test csr attribut string function oper asn hex string base est error presenc challeng password est error est asn saniti test string len pop present tag xclass j nid len save len len ostr string asn object object max len max csrattr assum challeng password oid present pop present make sure asn len min asn csrattr est err bad asn hex len j asn object string len tag xclass len est log info `` saniti tag d len d j d len d tag len j len j x est err bad asn hex tag v asn object object ci asn object null string len object null nid obj objnid object est log info `` nid d nid nid nid pkcs challeng password est log info `` challeng password oid pop present just signifiy s max len max csrattr withpop asn object free object adjust string pointer string len v asn set v asn sequenc len len save string ostr len est err bad asn hex len save max len est err bad asn hex est err est challeng password present base encod asn string scan challeng password includ est error presenc challeng password est error est challeng password present base ptr b len presenc assum presenc just data base ptr null b len est err est asn pars attribut base ptr b len presenc est asn pars attribut base decod saniti test given attribut string est error presenc challeng password est error est asn pars attribut p len pop present der ptr der len rv check smallest possibl base saniti test check min max valu asn data len min csrattr est err invalid paramet der ptr malloc len der ptr est err malloc der len est base decod p der ptr len der len est log err `` invalid base encod data free der ptr est err bad base rv est asn saniti test der ptr der len pop present rv est err est log err `` invalid asn encod data rv d s rv est err num str rv free der ptr rv free der ptr est err est add challeng password caller verifi challeng password configur includ add attribut saniti check need est challeng password present call est error est add challeng password base ptr b len new csr pop len der ptr orig ptr new der null csrattr der len tag xclass new len len enc len der ptr malloc b len der ptr est err malloc der len est base decod base ptr der ptr b len der len est log err `` malform base data free der ptr est err malloc orig ptr der ptr grab pop stuff asn object der ptr len tag xclass der len tag v asn sequenc est log err `` malform asn hex leand sequenc free orig ptr est err bad asn hex len der ptr orig ptr new len der len len hex chpw remov lead sequenc length copi new buffer need byte seq header der len len hex chpw new len new der malloc new len new der free orig ptr est err malloc memzero s new der new len new der x new der new len new der new len xff memcpi s new der der len len der ptr der len len need byte seq header der len len hex chpw new len new der malloc new len new der free orig ptr est err malloc memzero s new der new len new der x new der new len memcpi s new der der len rsize t len der ptr der len rsize t len just need byte header new len new der malloc new len new der free orig ptr est err malloc memzero s new der new len new der new len der len len memcpi s new der der len rsize t len der ptr der len rsize t len new der x memcpi s new der new len hex chpw hex chpw hex chpw hex chpw csrattr malloc new len csrattr free orig ptr free new der est err malloc memzero s csrattr new len enc len est base encod new der new len csrattr new len enc len est log err `` invalid base encod data free orig ptr free new der free csrattr est err bad base new csr csrattr pop len strnlen s csrattr new len est log info `` csr reconstitut attribut d d s b len pop len csrattr new der free new der orig ptr free orig ptr est err brief est add attribut helper add nid charact string x req attribut param req x req structur use csr request param nid nid ad attribut param string pointer nid string need param chtype type string use nid est error function use add csr attribut csr request est client est error est add attribut helper x req req nid string chtype req null est err invalid paramet nid est err invalid paramet string null est err invalid paramet mbstring asc use today caller pass valu chtype chtype mbstring asc x req add attr nid req nid chtype string est log warn `` error ad attribut est err x attr est err brief est decod attribut helper decod base encod string der format asn hex param csrattr pointer base encod string param csrattr len base string length param der ptr pointer pointer store der encod string param der len pointer store der string length est error function use decod base encod csr attribut string der format perform rang check input paramet est error est decod attribut helper csrattr csrattr len der len der ptr der len just data csrattr null csrattr len est err invalid paramet der null len null est err invalid paramet check smallest possibl base saniti test check min max valu asn data csrattr len min csrattr est err invalid paramet der ptr malloc csrattr len der ptr est err malloc der len est base decod csrattr der ptr csrattr len der len est log warn `` invalid base encod data free der ptr est err bad base der der ptr len der len est err brief est attribut helper attribut nid der encod string param der ptr pointer pointer der encod string param der len pointer der encod string length param new nid pointer storag nid est error function use nid der encod string nid reach end string new nid return zero est err bad asn hex est error est attribut helper der ptr der len new nid tag xclass j nid len save len len string ostr asn object object null der ptr null est err invalid paramet string der ptr ostr der ptr der len null est err invalid paramet len der len len save der len new nid null est err invalid paramet len j asn object string len tag xclass len j x est err bad asn hex tag v asn object object ci asn object null string len object null nid obj objnid object est log info `` nid d nid new nid nid der len len save string ostr der ptr string asn object free object est err adjust string pointer string len v asn set v asn sequenc len len save string ostr est err cleans auth credenti walk auth credenti structur overwrit free valu cleans auth credenti est http auth hdr auth cred auth cred null auth cred user openssl cleans auth cred user strnlen s auth cred user max uidpwd free auth cred user auth cred user null auth cred pwd openssl cleans auth cred pwd strnlen s auth cred pwd max uidpwd free auth cred pwd auth cred pwd null auth cred uri openssl cleans auth cred uri strnlen s auth cred uri est uri max len free auth cred uri auth cred uri null auth cred cnonc openssl cleans auth cred cnonc strnlen s auth cred cnonc max nonc free auth cred cnonc auth cred cnonc null auth cred qop openssl cleans auth cred qop strnlen s auth cred qop max qop free auth cred qop auth cred qop null auth cred nc openssl cleans auth cred nc strnlen s auth cred nc max nc free auth cred nc auth cred nc null auth cred nonc openssl cleans auth cred nonc strnlen s auth cred nonc max nonc free auth cred nonc auth cred nonc null auth cred respons openssl cleans auth cred respons strnlen s auth cred respons max respons free auth cred respons auth cred respons null auth cred auth token openssl cleans auth cred auth token strnlen s auth cred auth token max auth token len free auth cred auth token auth cred auth token null given input string look valid oper est oper est pars oper op path est oper oper est strcasecmp s op path est cacert oper est op cacert est strcasecmp s op path est csrattr oper est op csrattr est strcasecmp s op path est simpl enrol oper est op simpl enrol est strcasecmp s op path est simpl reenrol oper est op simpl reenrol oper est op max oper given input string look valid oper est error est pars uri uri est oper oper path seg path seg end path seg len uri parser state state uri uri pars uri est error rv est err uripars rc errno t safec rc diff path seg null state uri pars uri uripars rc uri pars uri state uri uripars rc uri success uri free uri member state uri est err http invalid path segment pars uri path head valid uri pars path prefix known est look path segment extens determin oper uri path segment cur seg pars uri path head cur seg str cur seg text cur seg len segment null safec rc memcmp s cur seg str known segment len `` known known segment len diff diff safec rc eok est log err `` uri path doe start s safec rc x x o\\n known segment safec rc uri free uri member state uri est err http invalid path segment cur seg cur seg cur seg str cur seg text safec rc memcmp s cur seg str est segment len `` est est segment len diff diff safec rc eok est log err `` uri doe contain s segment x x o\\n est segment safec rc uri free uri member state uri est err http invalid path segment segment segment extens s oper cur seg cur seg cur seg str cur seg text s segment use end walk length cur seg text cur seg len cur seg text cur seg str cur seg len strnlen s cur seg str est max path segment len cur seg len est max path segment len est log err `` path segment exceed maximum d\\n est max path segment len uri free uri member state uri est err http invalid path segment current segment need string cur seg text null cur seg text \\ segment strndup cur seg str cur seg len segment strndup cur seg str est max path segment len look oper path come cacert csrattr simpleenrol simplereenrol oper est pars oper segment oper est op max nt known oper path segment pars end path segment determin length save away path seg end cur seg text path seg end null path seg len path seg end cur seg str path seg malloc cur seg len path seg null free segment uri free uri member state uri est err malloc safec rc memcpi s path seg cur seg len segment cur seg len safec rc eok est log err `` uri path seg copi context free segment free path seg path seg null uri free uri member state uri est err http invalid path segment path seg cur seg len \\ path segment pars tri oper jump path segment cur seg str cur seg str cur seg len oper est pars oper cur seg str oper est op max oper code suppos free segment free path seg path seg null uri free uri member state uri est err http bad req oper make sure s end cur seg text null cur seg text \\ est log err `` invalid path segment contain oper valu free segment free path seg path seg null oper est op max uri free uri member state uri est err http invalid path segment free segment uri free uri member state uri rv given input string look valid oper est error est pars uri uri est oper oper path seg est error rc est err path seg null assum uri point known est oper strncmp uri est cacert uri est uri max len oper est op cacert strncmp uri est simpl enrol uri est uri max len oper est op simpl enrol strncmp uri est enrol uri est uri max len oper est op simpl reenrol strncmp uri est csr attr uri est uri max len oper est op csrattr oper est op max rc est err http invalid path segment rc store path segment context est error est store path segment est ctx ctx path segment path segment len reset cach ctx uri path segment free ctx uri path segment ctx uri path segment null ctx uri path segment malloc strnlen s path segment path segment len ctx uri path segment null est err malloc eok strncpi s ctx uri path segment path segment len path segment path segment len est err http invalid path segment ctx uri path segment  path segment len  \\ est err store path segment context est strcasecmp s s s errno t safec rc diff safec rc strcasecmp s s strnlen s s rsize max str s diff safec rc eok log encount safe c error est log info `` strcasecmp s error x x o\\n safec rc diff
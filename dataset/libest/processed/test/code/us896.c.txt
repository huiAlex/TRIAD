 c unit test user stori client csr attribut novemb copyright c cisco system right reserv includ stdio h ifndef win includ unistd h endif includ est h includ curl curl h includ `` curl util h includ `` test util h includ `` st server h includ openssl ssl h ifdef cunit includ `` cunit basic h includ `` cunit autom h endif ifndef win defin client ut cacert `` ca est ca cacert crt defin cacert `` ca est ca cacert crt defin trust cert `` ca trustedcert crt defin server certkey `` ca est ca privat estservercertandkey pem defin client ut cacert `` ca\\\\est ca\\\\cacert crt defin cacert `` ca\\\\est ca\\\\cacert crt defin trust cert `` ca\\\\trustedcert crt defin server certkey `` ca\\\\est ca\\\\private\\\\estservercertandkey pem endif defin client ut pubkey `` est client ut keypair defin server port defin server ip `` defin test attr `` m\\ defin test attr `` miienz ccagag aj gcaugag aw ydi dc eem ux mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otaw mtiz ndunzg mbjl mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mdey mz qnjc otasztey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdax mj mntyodkw em ux mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otaw mtiz ndunzg mbjl mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mdey mz qnjc otasztey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdax mj mntyodkw em ux mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otaw mtiz ndunzg mbjl mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mdey mz qnjc otatuvbhcn nl ifnfvcbhci ay ljk osi idey mz qnjc otax mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntyodkw mtiz ndunzg mayjyiziawudbaicbgkr jamdagg baqswaw ydi dc bmwqtyl bhcn nl ifnfvcbhci ay ljk osx igrhd geg mtiz ndunzg mdey mz qnjc otax mj mntyodkw ywix mj mntyodkw mtiz ndunzg mdey mz qnjc otax mj mntey mz qbgcr bg ebaqewbgcr bg ebaqew\\ defin test corrupt attr `` mhww laydi dc cmsugag aw ydi dc eexl qyxjz zsbtrvqg yxmg mi otku mi bk yxrh bglghkg bzqmeag igcssk aw mccaebcz ai bg oiex gx mzugfyc ug uvuigfz idiu otk lj zgfyqyhkw ybaqebfg yjko zihvc naqk h\\ defin test corrupt attr `` mihtmigbbg oinw ixeg eb w icapgag aw ydi dc ecg eceh ax mj mntyodkw qujdrevgex rqyxjz zsbtrvqg yxmg mi otku mh qfmtiz nduubtey mz qfg ux mj mnro fmtiz nduc faaaadeaaaay aaaamw aaadqaaaahgo amqay admanaabglghkg bzqmeag igcssk aw mccaebcz ai bg oinw ex gx mzugfyc ug uvuigfz idiu otk lj zgfyqyhkw ybaqebfg yhkw ybaqebfg ebaa\\ defin est ut max cmd len clean start server manual enrol nid rv rv st start server port server certkey server certkey `` test realm cacert trust cert `` ca est exampl ca cnf manual enrol nid sleep rv routin call cunit initi test suit use alloc data open resourc requir test case init suit rv cmd  est ut max cmd len  printf `` start est server csr attribut unit test \\n gen keypair use est client test snprintf cmd est ut max cmd len `` openssl ecparam primev genkey s client ut pubkey printf `` s\\n cmd rv cmd start server test need talk server clean start instanc est server rv start server rv routin call cunit uniniti test suit use dealloc data close resourc use test case destroy suit st stop sleep callback function pass est client init client manual cert verifi x cur cert openssl cert error bio bio err bio err bio new fp stderr bio noclos approv print specif cert printf `` s open ssl est server cert verif fail follow error openssl cert error d s \\n _ function__ openssl cert error x verifi cert error string openssl cert error printf `` fail cert \\n x print fp stdout cur cert print signatur use fingerprint fingerprint check anticip valu determin server s cert approv x signatur print bio err cur cert sig alg cur cert signatur openssl cert error x v err unabl crl approv bio free bio err approv test exercis est client csrattr api test rc csr data csr len est ctx ctx null log func nm rc est client csrattr ctx csr data csr len cu assert rc est err rc est client csrattr ctx null csr len cu assert rc est err rc est client csrattr ctx csr data null cu assert rc est err test exercis respons variat trigger est client csrattr test est ctx ctx pkey null cacert null cacert len est error rc est err retriev cacert null retriev cacert len evp pkey priv key sleep log func nm read ca certif cacert len read binari file client ut cacert cacert cu assert cacert len read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ctx est client init cacert cacert len est cert format pem client manual cert verifi cu assert ctx null rc est client set auth ctx `` `` null priv key cu assert rc est err est client set server ctx server ip server port null issu ca cert request rc est client cacert ctx retriev cacert len success obtain valid buffer contain ca cert cu assert rc est err cu assert retriev cacert len retriev cacert malloc retriev cacert len rc est client copi cacert ctx retriev cacert output retriev ca cert compar retriev cacert printf `` \\n retriev ca cert buffer \\n s\\n retriev cacert printf `` retriev ca cert buffer length d\\n retriev cacert len free retriev cacert negat test code est server modifi allow bad corrupt attribut initi sent client ifdef negat unit test csr data csr len clear callback est set csr cb ectx null printf `` \\n unabl set est csr attribut callback abort \\n exit rc est server init csrattr ectx test corrupt attr strlen test corrupt attr cu assert rc est err rc est client csrattr ctx csr data csr len cu assert rc est err cu assert csr len cu assert csr data null rc est server init csrattr ectx test corrupt attr strlen test corrupt attr cu assert rc est err rc est client csrattr ctx csr data csr len cu assert rc est err cu assert csr len cu assert csr data null rc est server init csrattr ectx test attr strlen test attr cu assert rc est err rc est client csrattr ctx csr data csr len cu assert rc est err cu assert csr len cu assert csr data null rc est server init csrattr ectx test attr strlen test attr cu assert rc est err rc est client csrattr ctx csr data csr len cu assert rc est err cu assert csr len cu assert csr data null endif ctx est destroy ctx cacert free cacert pkey free pkey main function set run test return cue success success run cunit error code failur add suit ifdef cunit cu p suit p suit null add suit registri p suit cu add suit `` client csrattr init suit destroy suit null p suit cu cleanup registri cu error add test suit null cu add test p suit `` csr client attribut api test null cu add test p suit `` csr client attribut api `` test cu cleanup registri cu error cue success endif
 c unit test uri path segment extens support march copyright c cisco system right reserv includ stdio h ifndef win includ unistd h endif includ est h includ curl curl h includ `` curl util h ifdef cunit includ `` cunit basic h includ `` cunit autom h endif includ `` util test util h includ `` st server h includ `` src est est locl h tst srvr path seg enrol   tst srvr path seg auth   path segment support max command line length generat command defin est ut max cmd len ca certif use verifi est server grab server s directori defin client ut cacert `` exampl server est ca cacert crt defin client ut cacert `` ca est ca cacert crt defin client ut pubkey `` est client ut keypair defin server port defin server ip `` defin uidpwd good `` estus estpwd defin uid `` estus defin pwd `` estpwd ifndef win defin cacert `` ca est ca cacert crt defin trust cert `` ca trustedcert crt defin server certkey `` ca est ca privat estservercertandkey pem defin cacert `` ca\\\\est ca\\\\cacert crt defin trust cert `` ca\\\\trustedcert crt defin server certkey `` ca\\\\est ca\\\\private\\\\estservercertandkey pem critic section logger critic section logger stderr format va list l enter critic section logger critic section vfprintf stderr format l fflush stderr leav critic section logger critic section endif defin enrol url ba `` https known est cacert somestr simpleenrol defin pkcs ct `` content type applic pkcs defin pkcs rsa `` miicv tccaa ucaqaw delmak gauebh mcvvmx cz ajbg nvbag mak dmqww cg ydvqqh\\n dansvfax ej aqbg nvbao mcvjtqwnlcn rjbz emmao gauecww dcn nh mraw dg ydvqqd\\n dadyc zgl mrow gayjko zihvc naqk bfgtyc fazgl lm nvb tccasiw dqyjko zi\\nhvc naqebbqadgg epadccaqo cgg ebanp ctbr ktbganq qhxhi nlopvxc jy\\n xa qz rjbo bexzqx bt ueygnh hola isasnz zkwpv mhjwm pynt oci y\\n fog ldb anm aoksfc mlbib ccsh holhaa fr wsk rtasew muoz fuv bkw ah ij\\n kpywsd yoxu wfig ehlm gplbzq fr bidrqk nlddgi xo dd nu lmjgdakv bww\\n baw ai vpsyevf wdr hwgg xn vt mw bp cgrll systum tgyb mcx jywe\\n lu mn djj zw ds zw ixa baxzax ei r xoxhn zmtefx y gp fk kv caw eaaa aamag\\n csq gsib dqebbquaaibaqbr iw nj elj fkrh q qe svee b aqa ruf zusku k\\nlsih ucfbk qvgljnhsc qucz ibn jzeq epq sdnom fwcv mc ah qf xfgyx jgpw f\\nutn uifj di zhr wgf j nnbt hrkecw zex z hcjt eci ek dsr ao bx yrcqt c\\n wq plvm llyjc zc skhvdnyakf sygmocsw gel vliz ocay asgbi ebw\\n rk ca yzwvhjqjp cuz jecl vdkpijb zgdjamdmdj zy pye auxar wss d\\nci um h ewtmr uzb lljkj jp bxrnontgm wzm qfhx client manual cert verifi x cur cert openssl cert error clean start server manual enrol nid rv rv st start server port server certkey server certkey `` test realm cacert trust cert `` ca est exampl ca cnf manual enrol nid sleep rv path seg support est ctx ectx cacert null cacert len est error rc est err sleep read ca certif cacert len read binari file client ut cacert cacert ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set server ectx server ip server port `` test segment rc est err routin call cunit initi test suit generat keypair use est client ut suit init suit rv cmd  est ut max cmd len  printf `` start est client proxi path segment unit test \\n check path segment support compil path segment support printf `` uri path segment support build est rebuild use uripars dir \\n gen keypair use est client test snprintf cmd est ut max cmd len `` openssl ecparam primev genkey s client ut pubkey printf `` s\\n cmd rv cmd start server test need talk server clean start instanc est server rv start server sleep rv routin call cunit uniniti test suit use dealloc data close resourc use test case destroy suit st stop callback function pass est client init client manual cert verifi x cur cert openssl cert error bio bio err bio err bio new fp stderr bio noclos approv print specif cert printf `` s open ssl est server cert verif fail follow error openssl cert error d s \\n _ function__ openssl cert error x verifi cert error string openssl cert error printf `` fail cert \\n x print fp stdout cur cert print signatur use fingerprint fingerprint check anticip valu determin server s cert approv x signatur print bio err cur cert sig alg cur cert signatur openssl cert error x v err unabl crl approv bio free bio err approv test test set server valid paramet path segment test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port null cu assert rc est err ectx est destroy ectx cacert free cacert pkey free pkey pass path segment valid test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` somestr cu assert rc est err ectx est destroy ectx cacert free cacert pkey free pkey pass path segment contain segment fail test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` somestr somestr cu assert rc est err http invalid path segment ectx est destroy ectx cacert free cacert pkey free pkey valid charact defin path seg valid char `` abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz _ test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port path seg valid char cu assert rc est err ectx est destroy ectx cacert free cacert pkey free pkey pass path segment invalid invalid charact test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` someinvalid string cu assert rc est err http invalid path segment ectx est destroy ectx cacert free cacert pkey free pkey pass path segment defin path segment `` test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port path segment cu assert rc est err http invalid path segment ectx est destroy ectx cacert free cacert pkey free pkey pass path segment equal oper cacert test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` cacert cu assert rc est err http invalid path segment ectx est destroy ectx cacert free cacert pkey free pkey pass path segment contain oper cacert s string test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` cacert server cu assert rc est err ectx est destroy ectx cacert free cacert pkey free pkey pass path segment string fail test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` cu assert rc est err http invalid path segment ectx est destroy ectx cacert free cacert pkey free pkey pass path segment contain pass test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port `` _ cu assert rc est err ectx est destroy ectx cacert free cacert pkey free pkey pass path segment defin path segment max `` test est ctx ectx pkey null cacert null cacert len est error rc est err evp pkey priv key sleep read ca certif cacert len read binari file client ut cacert cacert read privat key file priv key read privat key client ut pubkey priv key null printf `` \\n error read privat key file s\\n client ut pubkey ectx est client init cacert cacert len est cert format pem client manual cert verifi rc est client set auth ectx `` `` null priv key cu assert rc est err rc est client set server ectx server ip server port path segment max cu assert rc est err ectx est destroy ectx cacert free cacert pkey free pkey main function set run test return cue success success run cunit error code failur add suit cu error code cu error ifdef cunit cu p suit p suit null add suit registri p suit cu add suit `` client proxi path seg init suit destroy suit null p suit cu cleanup registri cu error ifdef win initi critic section logger critic section est init logger est log lvl info logger stderr endif check path segment support compil path seg support printf `` uri path segment support build est rebuild use uripars dir \\n path segment support path segment support path segment support add test suit note order import test fread fprintf null cu add test p suit `` est client set server correct paramet path segment test null cu add test p suit `` est client set server correct paramet valid path segment test null cu add test p suit `` est client set server correct paramet multi segment path segment test null cu add test p suit `` est client set server correct paramet valid path segment valid char test null cu add test p suit `` est client set server correct paramet invalid path segment test null cu add test p suit `` est client set server correct paramet path segment test null cu add test p suit `` est client set server correct paramet path segment equal oper string test null cu add test p suit `` est client set server correct paramet path segment contain oper string test null cu add test p suit `` est client set server correct paramet path segment string test null cu add test p suit `` est client set server correct paramet path segment contain colon test null cu add test p suit `` est client set server correct paramet path segment max length test cu error cu error printf `` d\\n cu error cu cleanup registri printf `` s\\n cu error msg cu error cue success endif